const __vite__fileDeps=["assets/index-Cnnre-7C.js","assets/react-core-C6dLrvtP.js","assets/semi-ui-Bu2vRZ6A.js","assets/semi-ui-Acpe-MiN.css","assets/tools-BYm9mvJU.js","assets/react-components-xfTEsaUe.js","assets/semantic-NrADMDYN.js","assets/index-BQlOR68m.js","assets/visactor-Bw5377hb.js","assets/index-c6E1ljfV.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as s,a as ct,u as Se,N as dt,L as eu,R as su,e as vu,f as ht,h as Ft,i as mt,j as Fe,B as pt}from"./react-core-C6dLrvtP.js";import{S as Ue,T as _e,e as S,f as nu,g as Ge,h as ce,B as v,I as te,i as V,j as Ae,D as Fu,F as ue,k as Je,l as Le,P as De,L as ae,m as Ku,C as qe,n as Pu,o as gt,M as je,R as xt,p as Et,q as au,r as yu,A as ku,s as Me,t as Ct,u as jt,v as ft,w as Ru,x as Bu,y as Du,z as Hu,E as Oe,G as qu,H as yt,J as Au,K as Qu,N as Bt,O as Dt,Q as At,U as $e,V as bt,W as Ju,X as Vu,Y as wt,Z as St,$ as vt,a0 as kt,a1 as _t,a2 as Tt,a3 as It,a4 as Pt,a5 as Rt}from"./semi-ui-Bu2vRZ6A.js";import{c as Mt,a as Lt}from"./tools-BYm9mvJU.js";import{Q as Ot,_ as Qe,T as Yu,f as ju,k as zt}from"./react-components-xfTEsaUe.js";import{G as Te,H as oe,I as _u,F as m,S as gu,B as Ne,M as mu,D as ge,a as cu,b as $t,L as Nt}from"./semantic-NrADMDYN.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function l(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=l(o);fetch(o.href,r)}})();var Zu={exports:{}},xu={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ut=s,Gt=Symbol.for("react.element"),Wt=Symbol.for("react.fragment"),Kt=Object.prototype.hasOwnProperty,Ht=Ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qt={key:!0,ref:!0,__self:!0,__source:!0};function Xu(u,t,l){var a,o={},r=null,c=null;l!==void 0&&(r=""+l),t.key!==void 0&&(r=""+t.key),t.ref!==void 0&&(c=t.ref);for(a in t)Kt.call(t,a)&&!qt.hasOwnProperty(a)&&(o[a]=t[a]);if(u&&u.defaultProps)for(a in t=u.defaultProps,t)o[a]===void 0&&(o[a]=t[a]);return{$$typeof:Gt,type:u,key:r,ref:c,props:o,_owner:Ht.current}}xu.Fragment=Wt;xu.jsx=Xu;xu.jsxs=Xu;Zu.exports=xu;var e=Zu.exports,bu={},Mu=ct;bu.createRoot=Mu.createRoot,bu.hydrateRoot=Mu.hydrateRoot;const Qt="modulepreload",Jt=function(u){return"/"+u},Lu={},Tu=function(t,l,a){let o=Promise.resolve();if(l&&l.length>0){const r=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),y=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));o=Promise.all(l.map(I=>{if(I=Jt(I),I in Lu)return;Lu[I]=!0;const R=I.endsWith(".css"),L=R?'[rel="stylesheet"]':"";if(!!a)for(let j=r.length-1;j>=0;j--){const h=r[j];if(h.href===I&&(!R||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${I}"]${L}`))return;const B=document.createElement("link");if(B.rel=R?"stylesheet":Qt,R||(B.as="script",B.crossOrigin=""),B.href=I,y&&B.setAttribute("nonce",y),document.head.appendChild(B),R)return new Promise((j,h)=>{B.addEventListener("load",j),B.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${I}`)))})}))}return o.then(()=>t()).catch(r=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r})},fe=({prompt:u="page"})=>e.jsxs(Ue,{style:{height:100},spinning:!0,children:["加载",u,"中..."]}),Vt=Mt(),ie=10,hu=[{key:1,text:"OpenAI",value:1,color:"green",label:"OpenAI"},{key:2,text:"Midjourney Proxy",value:2,color:"light-blue",label:"Midjourney Proxy"},{key:5,text:"Midjourney Proxy Plus",value:5,color:"blue",label:"Midjourney Proxy Plus"},{key:4,text:"Ollama",value:4,color:"grey",label:"Ollama"},{key:14,text:"Anthropic Claude",value:14,color:"indigo",label:"Anthropic Claude"},{key:3,text:"Azure OpenAI",value:3,color:"teal",label:"Azure OpenAI"},{key:11,text:"Google PaLM2",value:11,color:"orange",label:"Google PaLM2"},{key:24,text:"Google Gemini",value:24,color:"orange",label:"Google Gemini"},{key:15,text:"百度文心千帆",value:15,color:"blue",label:"百度文心千帆"},{key:17,text:"阿里通义千问",value:17,color:"orange",label:"阿里通义千问"},{key:18,text:"讯飞星火认知",value:18,color:"blue",label:"讯飞星火认知"},{key:16,text:"智谱 ChatGLM",value:16,color:"violet",label:"智谱 ChatGLM"},{key:16,text:"智谱 GLM-4V",value:26,color:"purple",label:"智谱 GLM-4V"},{key:16,text:"Moonshot",value:25,color:"green",label:"Moonshot"},{key:19,text:"360 智脑",value:19,color:"blue",label:"360 智脑"},{key:23,text:"腾讯混元",value:23,color:"teal",label:"腾讯混元"},{key:31,text:"零一万物",value:31,color:"green",label:"零一万物"},{key:8,text:"自定义渠道",value:8,color:"pink",label:"自定义渠道"},{key:22,text:"知识库：FastGPT",value:22,color:"blue",label:"知识库：FastGPT"},{key:21,text:"知识库：AI Proxy",value:21,color:"purple",label:"知识库：AI Proxy"}],Yt=({htmlContent:u})=>e.jsx("div",{dangerouslySetInnerHTML:{__html:u}});function be(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=10):!1}function et(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=100):!1}function Eu(){let u=localStorage.getItem("system_name");return u||"New API"}function lu(){let u=localStorage.getItem("logo");return u||"/logo.png"}function Zt(){return localStorage.getItem("footer_html")}async function Re(u){let t=!0;try{await navigator.clipboard.writeText(u)}catch(l){t=!1,console.error(l)}return t}function Be(){return window.innerWidth<=600}let ut={autoClose:!1};Be()&&(ut.position="top-center");function p(u){if(console.error(u),u.message){if(u.name==="AxiosError"){switch(u.response.status){case 401:window.location.href="/login?expired=true";break;case 429:_e.error("错误：请求次数过多，请稍后再试！");break;case 500:_e.error("错误：服务器内部错误，请联系管理员！");break;case 405:_e.info("本站仅作演示之用，无服务端！");break;default:_e.error("错误："+u.message)}return}_e.error("错误："+u.message)}else _e.error("错误："+u)}function Z(u){_e.success(u)}function ye(u){_e.info(u)}function Ou(u,t=!1){t?Ot(e.jsx(Yt,{htmlContent:u}),ut):_e.info(u)}function fu(u){return u.endsWith("/")?u.slice(0,-1):u}function we(u){let t=new Date(u*1e3),l=t.getFullYear().toString(),a=(t.getMonth()+1).toString(),o=t.getDate().toString(),r=t.getHours().toString(),c=t.getMinutes().toString(),y=t.getSeconds().toString();return a.length===1&&(a="0"+a),o.length===1&&(o="0"+o),r.length===1&&(r="0"+r),c.length===1&&(c="0"+c),y.length===1&&(y="0"+y),l+"-"+a+"-"+o+" "+r+":"+c+":"+y}function En(u,t="hour"){let l=new Date(u*1e3),a=(l.getMonth()+1).toString(),o=l.getDate().toString(),r=l.getHours().toString();a.length===1&&(a="0"+a),o.length===1&&(o="0"+o),r.length===1&&(r="0"+r);let c=a+"-"+o;if(t==="hour")c+=" "+r+":00";else if(t==="week"){let y=new Date(u*1e3+5184e5),I=(y.getMonth()+1).toString(),R=y.getDate().toString();I.length===1&&(I="0"+I),R.length===1&&(R="0"+R),c+=" - "+I+"-"+R}return c}function Xt(u,t){let l=new Blob([u],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(l),o=document.createElement("a");o.href=a,o.download=t,o.click()}const Xe=u=>{try{JSON.parse(u)}catch{return!1}return!0};function es(u){return!localStorage.getItem(`prompt-${u}`)}var zu={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const _=Lt.create({baseURL:zu.VITE_REACT_APP_SERVER_URL?zu.VITE_REACT_APP_SERVER_URL:""});_.interceptors.response.use(u=>u,u=>{p(u)});function tt(u){if(u==="")return e.jsx(S,{size:"large",children:"unknown"},"default");const t={vip:"yellow",pro:"yellow",svip:"red",premium:"red"},l=u.split(",").sort();return e.jsx("span",{children:l.map(a=>e.jsx(S,{size:"large",color:t[a]||tu(a),children:a},a))},u)}function pu(u){return u>=1e9?(u/1e9).toFixed(1)+"B":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e4?(u/1e3).toFixed(1)+"k":u}function Cn(u,t=2){let l=localStorage.getItem("display_in_currency");return u=u.toFixed(t),l?"$"+u:u}function us(u){if(u=u.toFixed(2),u>=1e5){let t=u.toString(),l=t.indexOf("."),a=t,o="";return l!==-1&&(a=t.slice(0,l),o=t.slice(l)),a.slice(0,2)+".."+a.slice(-2)+o}return u}function du(){let u=localStorage.getItem("quota_per_unit");return u=parseFloat(u),u}function ts(u){let t=localStorage.getItem("quota_per_unit");return t=parseFloat(t),u=parseFloat(u),t*u}function jn(u,t=6){let l=localStorage.getItem("quota_per_unit");return l=parseFloat(l),(u/l).toFixed(t)}function ss(u){let t=localStorage.getItem("display_in_currency");return t=t==="true",t?"$"+u:ts(u)}function xe(u,t=2){let l=localStorage.getItem("quota_per_unit"),a=localStorage.getItem("display_in_currency");return l=parseFloat(l),a=a==="true",a?"$"+(u/l).toFixed(t):pu(u)}function uu(u,t){let l=localStorage.getItem("display_in_currency");return l=l==="true",l?`（等价金额：${xe(u,t)}）`:""}const $u=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"],fn={"dall-e":"rgb(147,112,219)","dall-e-2":"rgb(147,112,219)","dall-e-3":"rgb(153,50,204)",midjourney:"rgb(136,43,180)","gpt-3.5-turbo":"rgb(184,227,167)","gpt-3.5-turbo-0301":"rgb(131,220,131)","gpt-3.5-turbo-0613":"rgb(60,179,113)","gpt-3.5-turbo-1106":"rgb(32,178,170)","gpt-3.5-turbo-16k":"rgb(252,200,149)","gpt-3.5-turbo-16k-0613":"rgb(255,181,119)","gpt-3.5-turbo-instruct":"rgb(175,238,238)","gpt-4":"rgb(135,206,235)","gpt-4-0314":"rgb(70,130,180)","gpt-4-0613":"rgb(100,149,237)","gpt-4-1106-preview":"rgb(30,144,255)","gpt-4-0125-preview":"rgb(2,177,236)","gpt-4-turbo-preview":"rgb(2,177,255)","gpt-4-32k":"rgb(104,111,238)","gpt-4-32k-0314":"rgb(90,105,205)","gpt-4-32k-0613":"rgb(61,71,139)","gpt-4-all":"rgb(65,105,225)","gpt-4-gizmo-*":"rgb(0,0,255)","gpt-4-vision-preview":"rgb(25,25,112)","text-ada-001":"rgb(255,192,203)","text-babbage-001":"rgb(255,160,122)","text-curie-001":"rgb(219,112,147)","text-davinci-002":"rgb(199,21,133)","text-davinci-003":"rgb(219,112,147)","text-davinci-edit-001":"rgb(255,105,180)","text-embedding-ada-002":"rgb(255,182,193)","text-embedding-v1":"rgb(255,174,185)","text-moderation-latest":"rgb(255,130,171)","text-moderation-stable":"rgb(255,160,122)","tts-1":"rgb(255,140,0)","tts-1-1106":"rgb(255,165,0)","tts-1-hd":"rgb(255,215,0)","tts-1-hd-1106":"rgb(255,223,0)","whisper-1":"rgb(245,245,220)"};function tu(u){let t=0;for(let a=0;a<u.length;a++)t+=u.charCodeAt(a);let l=t%$u.length;return $u[l]}const ns=u=>{const t={username:"",display_name:"",password:""},[l,a]=s.useState(t),[o,r]=s.useState(!1),{username:c,display_name:y,password:I}=l,R=(B,j)=>{a(h=>({...h,[B]:j}))},L=async()=>{if(r(!0),l.username===""||l.password==="")return;const B=await _.post("/api/user/",l),{success:j,message:h}=B.data;j?(Z("用户账户创建成功！"),a(t),u.refresh(),u.handleClose()):p(h),r(!1)},C=()=>{u.handleClose()};return e.jsx(e.Fragment,{children:e.jsx(nu,{placement:"left",title:e.jsx(Ge,{level:3,children:"添加用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(ce,{children:[e.jsx(v,{theme:"solid",size:"large",onClick:L,children:"提交"}),e.jsx(v,{theme:"solid",size:"large",type:"tertiary",onClick:C,children:"取消"})]})}),closeIcon:null,onCancel:()=>C(),width:Be()?"100%":600,children:e.jsxs(Ue,{spinning:o,children:[e.jsx(te,{style:{marginTop:20},label:"用户名",name:"username",addonBefore:"用户名",placeholder:"请输入用户名",onChange:B=>R("username",B),value:c,autoComplete:"off"}),e.jsx(te,{style:{marginTop:20},addonBefore:"显示名",label:"显示名称",name:"display_name",autoComplete:"off",placeholder:"请输入显示名称",onChange:B=>R("display_name",B),value:y}),e.jsx(te,{style:{marginTop:20},label:"密 码",name:"password",type:"password",addonBefore:"密码",placeholder:"请输入密码",onChange:B=>R("password",B),value:I,autoComplete:"off"})]})})})},wu=u=>{const t=u.editingUser.id,[l,a]=s.useState(!0),[o,r]=s.useState({username:"",display_name:"",password:"",github_id:"",wechat_id:"",email:"",quota:0,group:"default"}),[c,y]=s.useState([]),{username:I,display_name:R,password:L,github_id:C,wechat_id:B,telegram_id:j,email:h,quota:D,group:A}=o,F=(k,Q)=>{r(X=>({...X,[k]:Q}))},P=async()=>{try{let k=await _.get("/api/group/");y(k.data.data.map(Q=>({label:Q,value:Q})))}catch(k){p(k.message)}};Se();const M=()=>{u.handleClose()},q=async()=>{a(!0);let k;t?k=await _.get(`/api/user/${t}`):k=await _.get("/api/user/self");const{success:Q,message:X,data:U}=k.data;Q?(U.password="",r(U)):p(X),a(!1)};s.useEffect(()=>{q().then(),t&&P().then()},[u.editingUser.id]);const W=async()=>{a(!0);let k;if(t){let U={...o,id:parseInt(t)};typeof U.quota=="string"&&(U.quota=parseInt(U.quota)),k=await _.put("/api/user/",U)}else k=await _.put("/api/user/self",o);const{success:Q,message:X}=k.data;Q?(Z("用户信息更新成功！"),u.refresh(),u.handleClose()):p(X),a(!1)};return e.jsx(e.Fragment,{children:e.jsx(nu,{placement:"right",title:e.jsx(Ge,{level:3,children:"编辑用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(ce,{children:[e.jsx(v,{theme:"solid",size:"large",onClick:W,children:"提交"}),e.jsx(v,{theme:"solid",size:"large",type:"tertiary",onClick:M,children:"取消"})]})}),closeIcon:null,onCancel:()=>M(),width:Be()?"100%":600,children:e.jsxs(Ue,{spinning:l,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:"用户名"})}),e.jsx(te,{label:"用户名",name:"username",placeholder:"请输入新的用户名",onChange:k=>F("username",k),value:I,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:"密码"})}),e.jsx(te,{label:"密码",name:"password",type:"password",placeholder:"请输入新的密码，最短 8 位",onChange:k=>F("password",k),value:L,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:"显示名称"})}),e.jsx(te,{label:"显示名称",name:"display_name",placeholder:"请输入新的显示名称",onChange:k=>F("display_name",k),value:R,autoComplete:"new-password"}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:"分组"})}),e.jsx(Ae,{placeholder:"请选择分组",name:"group",fluid:!0,search:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:k=>F("group",k),value:o.group,autoComplete:"new-password",optionList:c}),e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:`剩余额度${uu(D)}`})}),e.jsx(te,{name:"quota",placeholder:"请输入新的剩余额度",onChange:k=>F("quota",k),value:D,type:"number",autoComplete:"new-password"})]}),e.jsx(Fu,{style:{marginTop:20},children:"以下信息不可修改"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:"已绑定的 GitHub 账户"})}),e.jsx(te,{name:"github_id",value:C,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:"已绑定的微信账户"})}),e.jsx(te,{name:"wechat_id",value:B,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:"已绑定的邮箱账户"})}),e.jsx(te,{name:"email",value:h,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:"已绑定的Telegram账户"})}),e.jsx(te,{name:"telegram_id",value:j,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0})]})})})};function as(u){switch(u){case 1:return e.jsx(S,{size:"large",children:"普通用户"});case 10:return e.jsx(S,{color:"yellow",size:"large",children:"管理员"});case 100:return e.jsx(S,{color:"orange",size:"large",children:"超级管理员"});default:return e.jsx(S,{color:"red",size:"large",children:"未知身份"})}}const ls=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"用户名",dataIndex:"username"},{title:"分组",dataIndex:"group",render:(n,i,d)=>e.jsx("div",{children:tt(n)})},{title:"统计信息",dataIndex:"info",render:(n,i,d)=>e.jsx("div",{children:e.jsxs(ce,{spacing:1,children:[e.jsx(Le,{content:"剩余额度",children:e.jsx(S,{color:"white",size:"large",children:xe(i.quota)})}),e.jsx(Le,{content:"已用额度",children:e.jsx(S,{color:"white",size:"large",children:xe(i.used_quota)})}),e.jsx(Le,{content:"调用次数",children:e.jsx(S,{color:"white",size:"large",children:pu(i.request_count)})})]})})},{title:"邀请信息",dataIndex:"invite",render:(n,i,d)=>e.jsx("div",{children:e.jsxs(ce,{spacing:1,children:[e.jsx(Le,{content:"邀请人数",children:e.jsx(S,{color:"white",size:"large",children:pu(i.aff_count)})}),e.jsx(Le,{content:"邀请总收益",children:e.jsx(S,{color:"white",size:"large",children:xe(i.aff_history_quota)})}),e.jsx(Le,{content:"邀请人ID",children:i.inviter_id===0?e.jsx(S,{color:"white",size:"large",children:"无"}):e.jsx(S,{color:"white",size:"large",children:i.inviter_id})})]})})},{title:"角色",dataIndex:"role",render:(n,i,d)=>e.jsx("div",{children:as(n)})},{title:"状态",dataIndex:"status",render:(n,i,d)=>e.jsx("div",{children:i.DeletedAt!==null?e.jsx(S,{color:"red",children:"已注销"}):Q(n)})},{title:"",dataIndex:"operate",render:(n,i,d)=>e.jsxs("div",{children:[i.DeletedAt!==null?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(De,{title:"确定？",okType:"warning",onConfirm:()=>{k(i.username,"promote",i)},children:e.jsx(v,{theme:"light",type:"warning",style:{marginRight:1},children:"提升"})}),e.jsx(De,{title:"确定？",okType:"warning",onConfirm:()=>{k(i.username,"demote",i)},children:e.jsx(v,{theme:"light",type:"secondary",style:{marginRight:1},children:"降级"})}),i.status===1?e.jsx(v,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{k(i.username,"disable",i)},children:"禁用"}):e.jsx(v,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{k(i.username,"enable",i)},disabled:i.status===3,children:"启用"}),e.jsx(v,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{P(i),A(!0)},children:"编辑"})]}),e.jsx(De,{title:"确定是否要删除此用户？",content:"硬删除，此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{k(i.username,"delete",i).then(()=>{q(i.id)})},children:e.jsx(v,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})})]})}],[t,l]=s.useState([]),[a,o]=s.useState(!0),[r,c]=s.useState(1),[y,I]=s.useState(""),[R,L]=s.useState(!1),[C,B]=s.useState(ie),[j,h]=s.useState(!1),[D,A]=s.useState(!1),[F,P]=s.useState({id:void 0}),M=n=>{n.length>=r*ie?B(n.length+1):B(n.length)},q=n=>{console.log(n);let i=[...t];if(n!=null){let d=i.findIndex(H=>H.id===n);d>-1&&(i.splice(d,1),l(i))}},W=async n=>{const i=await _.get(`/api/user/?p=${n}`),{success:d,message:H,data:Y}=i.data;if(d)if(n===0)l(Y),M(Y);else{let b=t;b.push(...Y),l(b),M(b)}else p(H);o(!1)};s.useEffect(()=>{W(0).then().catch(n=>{p(n)})},[]);const k=async(n,i,d)=>{const H=await _.post("/api/user/manage",{username:n,action:i}),{success:Y,message:b}=H.data;if(Y){Z("操作成功完成！");let J=H.data.data,w=[...t];i==="delete"||(d.status=J.status,d.role=J.role),l(w)}else p(b)},Q=n=>{switch(n){case 1:return e.jsx(S,{size:"large",children:"已激活"});case 2:return e.jsx(S,{size:"large",color:"red",children:"已封禁"});default:return e.jsx(S,{size:"large",color:"grey",children:"未知状态"})}},X=async()=>{if(y===""){await W(0),c(1);return}L(!0);const n=await _.get(`/api/user/search?keyword=${y}`),{success:i,message:d,data:H}=n.data;i?(l(H),c(1)):p(d),L(!1)},U=async n=>{I(n.trim())},O=n=>{c(n),n===Math.ceil(t.length/ie)+1&&W(n-1).then(i=>{})},g=t.slice((r-1)*ie,r*ie),K=()=>{h(!1)},N=()=>{A(!1),P({id:void 0})},T=async()=>{y===""?await W(r-1):await X()};return e.jsxs(e.Fragment,{children:[e.jsx(ns,{refresh:T,visible:j,handleClose:K}),e.jsx(wu,{refresh:T,visible:D,handleClose:N,editingUser:F}),e.jsx(ue,{onSubmit:X,children:e.jsx(ue.Input,{label:"搜索关键字",icon:"search",field:"keyword",iconPosition:"left",placeholder:"搜索用户的 ID，用户名，显示名称，以及邮箱地址 ...",value:y,loading:R,onChange:n=>U(n)})}),e.jsx(Je,{columns:u,dataSource:g,pagination:{currentPage:r,pageSize:ie,total:C,pageSizeOpts:[10,20,50,100],onPageChange:O},loading:a}),e.jsx(v,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{h(!0)},children:"添加用户"})]})},is=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"管理用户"})}),e.jsx(ae.Content,{children:e.jsx(ls,{})})]})});function Pe({children:u}){return localStorage.getItem("user")?u:e.jsx(dt,{to:"/login",state:{from:Vt.location}})}const rs=()=>{const[u,t]=s.useState({username:"",password:"",password2:"",email:"",verification_code:""}),{username:l,password:a,password2:o}=u,[r,c]=s.useState(!1),[y,I]=s.useState(!1),[R,L]=s.useState(""),[C,B]=s.useState(""),[j,h]=s.useState(!1),D=lu();let A=new URLSearchParams(window.location.search).get("aff");A&&localStorage.setItem("aff",A),s.useEffect(()=>{let W=localStorage.getItem("status");W&&(W=JSON.parse(W),c(W.email_verification),W.turnstile_check&&(I(!0),L(W.turnstile_site_key)))});let F=Se();function P(W){const{name:k,value:Q}=W.target;console.log(k,Q),t(X=>({...X,[k]:Q}))}async function M(W){if(a.length<8){ye("密码长度不得小于 8 位！");return}if(a!==o){ye("两次输入的密码不一致");return}if(l&&a){if(y&&C===""){ye("请稍后几秒重试，Turnstile 正在检查用户环境！");return}h(!0),A||(A=localStorage.getItem("aff")),u.aff_code=A;const k=await _.post(`/api/user/register?turnstile=${C}`,u),{success:Q,message:X}=k.data;Q?(F("/login"),Z("注册成功！")):p(X),h(!1)}}const q=async()=>{if(u.email==="")return;if(y&&C===""){ye("请稍后几秒重试，Turnstile 正在检查用户环境！");return}h(!0);const W=await _.get(`/api/verification?email=${u.email}&turnstile=${C}`),{success:k,message:Q}=W.data;k?Z("验证码发送成功，请检查你的邮箱！"):p(Q),h(!1)};return e.jsx(Te,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(Te.Column,{style:{maxWidth:450},children:[e.jsxs(oe,{as:"h2",color:"",textAlign:"center",children:[e.jsx(_u,{src:D})," 新用户注册"]}),e.jsx(m,{size:"large",children:e.jsxs(gu,{children:[e.jsx(m.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"输入用户名，最长 12 位",onChange:P,name:"username"}),e.jsx(m.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入密码，最短 8 位，最长 20 位",onChange:P,name:"password",type:"password"}),e.jsx(m.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入密码，最短 8 位，最长 20 位",onChange:P,name:"password2",type:"password"}),r?e.jsxs(e.Fragment,{children:[e.jsx(m.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"输入邮箱地址",onChange:P,name:"email",type:"email",action:e.jsx(Ne,{onClick:q,disabled:j,children:"获取验证码"})}),e.jsx(m.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入验证码",onChange:P,name:"verification_code"})]}):e.jsx(e.Fragment,{}),y?e.jsx(Qe,{sitekey:R,onVerify:W=>{B(W)}}):e.jsx(e.Fragment,{}),e.jsx(Ne,{color:"green",fluid:!0,size:"large",onClick:M,loading:j,children:"注册"})]})}),e.jsxs(mu,{children:["已有账户？",e.jsx(eu,{to:"/login",className:"btn btn-link",children:"点击登录"})]})]})})},os=(u,t)=>{switch(t.type){case"login":return{...u,user:t.payload};case"logout":return{...u,user:void 0};default:return u}},st={user:void 0},We=su.createContext({state:st,dispatch:()=>null}),cs=({children:u})=>{const[t,l]=su.useReducer(os,st);return e.jsx(We.Provider,{value:[t,l],children:u})};async function ds(){const u=await _.get("/api/oauth/state"),{success:t,message:l,data:a}=u.data;return t?a:(p(l),"")}async function nt(u){const t=await ds();t&&window.open(`https://github.com/login/oauth/authorize?client_id=${u}&state=${t}&scope=user:email`)}const hs=()=>{function u(){return e.jsxs("svg",{t:"1709714447384",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5091",width:"16",height:"16",children:[e.jsx("path",{d:"M690.1 377.4c5.9 0 11.8 0.2 17.6 0.5-24.4-128.7-158.3-227.1-319.9-227.1C209 150.8 64 271.4 64 420.2c0 81.1 43.6 154.2 111.9 203.6 5.5 3.9 9.1 10.3 9.1 17.6 0 2.4-0.5 4.6-1.1 6.9-5.5 20.3-14.2 52.8-14.6 54.3-0.7 2.6-1.7 5.2-1.7 7.9 0 5.9 4.8 10.8 10.8 10.8 2.3 0 4.2-0.9 6.2-2l70.9-40.9c5.3-3.1 11-5 17.2-5 3.2 0 6.4 0.5 9.5 1.4 33.1 9.5 68.8 14.8 105.7 14.8 6 0 11.9-0.1 17.8-0.4-7.1-21-10.9-43.1-10.9-66 0-135.8 132.2-245.8 295.3-245.8z m-194.3-86.5c23.8 0 43.2 19.3 43.2 43.1s-19.3 43.1-43.2 43.1c-23.8 0-43.2-19.3-43.2-43.1s19.4-43.1 43.2-43.1z m-215.9 86.2c-23.8 0-43.2-19.3-43.2-43.1s19.3-43.1 43.2-43.1 43.2 19.3 43.2 43.1-19.4 43.1-43.2 43.1z","p-id":"5092"}),e.jsx("path",{d:"M866.7 792.7c56.9-41.2 93.2-102 93.2-169.7 0-124-120.8-224.5-269.9-224.5-149 0-269.9 100.5-269.9 224.5S540.9 847.5 690 847.5c30.8 0 60.6-4.4 88.1-12.3 2.6-0.8 5.2-1.2 7.9-1.2 5.2 0 9.9 1.6 14.3 4.1l59.1 34c1.7 1 3.3 1.7 5.2 1.7 2.4 0 4.7-0.9 6.4-2.6 1.7-1.7 2.6-4 2.6-6.4 0-2.2-0.9-4.4-1.4-6.6-0.3-1.2-7.6-28.3-12.2-45.3-0.5-1.9-0.9-3.8-0.9-5.7 0.1-5.9 3.1-11.2 7.6-14.5zM600.2 587.2c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c0 19.8-16.2 35.9-36 35.9z m179.9 0c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c-0.1 19.8-16.2 35.9-36 35.9z","p-id":"5093"})]})}return e.jsx("div",{children:e.jsx(Ku,{svg:e.jsx(u,{})})})},Fs=()=>{const[u,t]=s.useState({username:"",password:"",wechat_verification_code:""}),[l,a]=vu(),[o,r]=s.useState(!1),{username:c,password:y}=u,[I,R]=s.useContext(We),[L,C]=s.useState(!1),[B,j]=s.useState(""),[h,D]=s.useState("");let A=Se();const[F,P]=s.useState({});lu(),s.useEffect(()=>{l.get("expired")&&p("未登录或登录已过期，请重新登录！");let O=localStorage.getItem("status");O&&(O=JSON.parse(O),P(O),O.turnstile_check&&(C(!0),j(O.turnstile_site_key)))},[]);const[M,q]=s.useState(!1),W=()=>{q(!0)},k=async()=>{if(L&&h===""){ye("请稍后几秒重试，Turnstile 正在检查用户环境！");return}const O=await _.get(`/api/oauth/wechat?code=${u.wechat_verification_code}`),{success:g,message:K,data:N}=O.data;g?(R({type:"login",payload:N}),localStorage.setItem("user",JSON.stringify(N)),A("/"),Z("登录成功！"),q(!1)):p(K)};function Q(O,g){t(K=>({...K,[O]:g}))}async function X(O){if(L&&h===""){ye("请稍后几秒重试，Turnstile 正在检查用户环境！");return}if(r(!0),c&&y){const g=await _.post(`/api/user/login?turnstile=${h}`,{username:c,password:y}),{success:K,message:N,data:T}=g.data;K?(R({type:"login",payload:T}),localStorage.setItem("user",JSON.stringify(T)),Z("登录成功！"),c==="root"&&y==="123456"&&je.error({title:"您正在使用默认密码！",content:"请立刻修改默认密码！",centered:!0}),A("/token")):p(N)}else p("请输入用户名和密码！")}const U=async O=>{const g=["id","first_name","last_name","username","photo_url","auth_date","hash","lang"],K={};g.forEach(d=>{O[d]&&(K[d]=O[d])});const N=await _.get("/api/oauth/telegram/login",{params:K}),{success:T,message:n,data:i}=N.data;T?(R({type:"login",payload:i}),localStorage.setItem("user",JSON.stringify(i)),Z("登录成功！"),A("/")):p(n)};return e.jsx("div",{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{}),e.jsx(ae.Content,{children:e.jsx("div",{style:{justifyContent:"center",display:"flex",marginTop:120},children:e.jsxs("div",{style:{width:500},children:[e.jsxs(qe,{children:[e.jsx(Ge,{heading:2,style:{textAlign:"center"},children:"用户登录"}),e.jsxs(ue,{children:[e.jsx(ue.Input,{field:"username",label:"用户名",placeholder:"用户名",name:"username",onChange:O=>Q("username",O)}),e.jsx(ue.Input,{field:"password",label:"密码",placeholder:"密码",name:"password",type:"password",onChange:O=>Q("password",O)}),e.jsx(v,{theme:"solid",style:{width:"100%"},type:"primary",size:"large",htmlType:"submit",onClick:X,children:"登录"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:20},children:[e.jsxs(Pu,{children:["没有账号请先 ",e.jsx(eu,{to:"/register",children:"注册账号"})]}),e.jsxs(Pu,{children:["忘记密码 ",e.jsx(eu,{to:"/reset",children:"点击重置"})]})]}),F.github_oauth||F.wechat_login||F.telegram_oauth?e.jsxs(e.Fragment,{children:[e.jsx(Fu,{margin:"12px",align:"center",children:"第三方登录"}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:[F.github_oauth?e.jsx(v,{type:"primary",icon:e.jsx(gt,{}),onClick:()=>nt(F.github_client_id)}):e.jsx(e.Fragment,{}),F.wechat_login?e.jsx(v,{type:"primary",style:{color:"rgba(var(--semi-green-5), 1)"},icon:e.jsx(Ku,{svg:e.jsx(hs,{})}),onClick:W}):e.jsx(e.Fragment,{}),F.telegram_oauth?e.jsx(Yu,{dataOnauth:U,botName:F.telegram_bot_name}):e.jsx(e.Fragment,{})]})]}):e.jsx(e.Fragment,{}),e.jsxs(je,{title:"微信扫码登录",visible:M,maskClosable:!0,onOk:k,onCancel:()=>q(!1),okText:"登录",size:"small",centered:!0,children:[e.jsx("div",{style:{display:"flex",alignItem:"center",flexDirection:"column"},children:e.jsx("img",{src:F.wechat_qrcode})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(ue,{size:"large",children:e.jsx(ue.Input,{field:"wechat_verification_code",placeholder:"验证码",label:"验证码",value:u.wechat_verification_code,onChange:O=>Q("wechat_verification_code",O)})})]})]}),L?e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:e.jsx(Qe,{sitekey:B,onVerify:O=>{D(O)}})}):e.jsx(e.Fragment,{})]})})})]})})},ms=()=>e.jsx(e.Fragment,{children:e.jsxs(mu,{negative:!0,children:[e.jsx(mu.Header,{children:"页面不存在"}),e.jsx("p",{children:"请检查你的浏览器地址是否正确"})]})}),at=s.createContext(null),Iu=()=>s.useContext(at),lt=s.createContext(null),ps=()=>s.useContext(lt),gs=({children:u})=>{const[t,l]=s.useState(()=>{try{return localStorage.getItem("theme-mode")||null}catch{return null}}),a=s.useCallback(o=>{l(o?"dark":"light");const r=document.body;o?(r.setAttribute("theme-mode","dark"),localStorage.setItem("theme-mode","dark")):(r.removeAttribute("theme-mode"),localStorage.setItem("theme-mode","light"))},[]);return e.jsx(lt.Provider,{value:a,children:e.jsx(at.Provider,{value:t,children:u})})},xs=()=>{let[u,t]=s.useState({PasswordLoginEnabled:"",PasswordRegisterEnabled:"",EmailVerificationEnabled:"",GitHubOAuthEnabled:"",GitHubClientId:"",GitHubClientSecret:"",Notice:"",SMTPServer:"",SMTPPort:"",SMTPAccount:"",SMTPFrom:"",SMTPToken:"",ServerAddress:"",EpayId:"",EpayKey:"",Price:7.3,MinTopUp:1,TopupGroupRatio:"",PayAddress:"",CustomCallbackAddress:"",Footer:"",WeChatAuthEnabled:"",WeChatServerAddress:"",WeChatServerToken:"",WeChatAccountQRCodeImageURL:"",TurnstileCheckEnabled:"",TurnstileSiteKey:"",TurnstileSecretKey:"",RegisterEnabled:"",EmailDomainRestrictionEnabled:"",EmailAliasRestrictionEnabled:"",SMTPSSLEnabled:"",EmailDomainWhitelist:[],TelegramOAuthEnabled:"",TelegramBotToken:"",TelegramBotName:""});const[l,a]=s.useState({});let[o,r]=s.useState(!1);const[c,y]=s.useState([]),[I,R]=s.useState(""),[L,C]=s.useState(!1),j=Iu()==="dark",h=async()=>{const O=await _.get("/api/option/"),{success:g,message:K,data:N}=O.data;if(g){let T={};N.forEach(n=>{n.key==="TopupGroupRatio"&&(n.value=JSON.stringify(JSON.parse(n.value),null,2)),T[n.key]=n.value}),t({...T,EmailDomainWhitelist:T.EmailDomainWhitelist.split(",")}),a(T),y(T.EmailDomainWhitelist.split(",").map(n=>({key:n,text:n,value:n})))}else p(K)};s.useEffect(()=>{h().then()},[]),s.useEffect(()=>{},[u.EmailDomainWhitelist]);const D=async(O,g)=>{switch(r(!0),O){case"PasswordLoginEnabled":case"PasswordRegisterEnabled":case"EmailVerificationEnabled":case"GitHubOAuthEnabled":case"WeChatAuthEnabled":case"TelegramOAuthEnabled":case"TurnstileCheckEnabled":case"EmailDomainRestrictionEnabled":case"EmailAliasRestrictionEnabled":case"SMTPSSLEnabled":case"RegisterEnabled":g=u[O]==="true"?"false":"true";break}const K=await _.put("/api/option/",{key:O,value:g}),{success:N,message:T}=K.data;N?(O==="EmailDomainWhitelist"&&(g=g.split(",")),O==="Price"&&(g=parseFloat(g)),t(n=>({...n,[O]:g}))):p(T),r(!1)},A=async(O,{name:g,value:K})=>{if(g==="PasswordLoginEnabled"&&u[g]==="true"){C(!0);return}g==="Notice"||g.startsWith("SMTP")&&g!=="SMTPSSLEnabled"||g==="ServerAddress"||g==="EpayId"||g==="EpayKey"||g==="Price"||g==="PayAddress"||g==="GitHubClientId"||g==="GitHubClientSecret"||g==="WeChatServerAddress"||g==="WeChatServerToken"||g==="WeChatAccountQRCodeImageURL"||g==="TurnstileSiteKey"||g==="TurnstileSecretKey"||g==="EmailDomainWhitelist"||g==="TopupGroupRatio"||g==="TelegramBotToken"||g==="TelegramBotName"?t(N=>({...N,[g]:K})):await D(g,K)},F=async()=>{let O=fu(u.ServerAddress);await D("ServerAddress",O)},P=async()=>{if(u.ServerAddress===""){p("请先填写服务器地址");return}if(l.TopupGroupRatio!==u.TopupGroupRatio){if(!Xe(u.TopupGroupRatio)){p("充值分组倍率不是合法的 JSON 字符串");return}await D("TopupGroupRatio",u.TopupGroupRatio)}let O=fu(u.PayAddress);await D("PayAddress",O),u.EpayId!==""&&await D("EpayId",u.EpayId),u.EpayKey!==""&&await D("EpayKey",u.EpayKey),await D("Price",""+u.Price)},M=async()=>{l.SMTPServer!==u.SMTPServer&&await D("SMTPServer",u.SMTPServer),l.SMTPAccount!==u.SMTPAccount&&await D("SMTPAccount",u.SMTPAccount),l.SMTPFrom!==u.SMTPFrom&&await D("SMTPFrom",u.SMTPFrom),l.SMTPPort!==u.SMTPPort&&u.SMTPPort!==""&&await D("SMTPPort",u.SMTPPort),l.SMTPToken!==u.SMTPToken&&u.SMTPToken!==""&&await D("SMTPToken",u.SMTPToken)},q=async()=>{l.EmailDomainWhitelist!==u.EmailDomainWhitelist.join(",")&&u.SMTPToken!==""&&await D("EmailDomainWhitelist",u.EmailDomainWhitelist.join(","))},W=async()=>{l.WeChatServerAddress!==u.WeChatServerAddress&&await D("WeChatServerAddress",fu(u.WeChatServerAddress)),l.WeChatAccountQRCodeImageURL!==u.WeChatAccountQRCodeImageURL&&await D("WeChatAccountQRCodeImageURL",u.WeChatAccountQRCodeImageURL),l.WeChatServerToken!==u.WeChatServerToken&&u.WeChatServerToken!==""&&await D("WeChatServerToken",u.WeChatServerToken)},k=async()=>{l.GitHubClientId!==u.GitHubClientId&&await D("GitHubClientId",u.GitHubClientId),l.GitHubClientSecret!==u.GitHubClientSecret&&u.GitHubClientSecret!==""&&await D("GitHubClientSecret",u.GitHubClientSecret)},Q=async()=>{await D("TelegramBotToken",u.TelegramBotToken),await D("TelegramBotName",u.TelegramBotName)},X=async()=>{l.TurnstileSiteKey!==u.TurnstileSiteKey&&await D("TurnstileSiteKey",u.TurnstileSiteKey),l.TurnstileSecretKey!==u.TurnstileSecretKey&&u.TurnstileSecretKey!==""&&await D("TurnstileSecretKey",u.TurnstileSecretKey)},U=()=>{const O=u.EmailDomainWhitelist;I!==""&&!O.includes(I)&&(R(""),t({...u,EmailDomainWhitelist:[...O,I]}),y([...c,{key:I,text:I,value:I}]))};return e.jsx(Te,{columns:1,children:e.jsx(Te.Column,{children:e.jsxs(m,{loading:o,inverted:j,children:[e.jsx(oe,{as:"h3",inverted:j,children:"通用设置"}),e.jsx(m.Group,{widths:"equal",children:e.jsx(m.Input,{label:"服务器地址",placeholder:"例如：https://yourdomain.com",value:u.ServerAddress,name:"ServerAddress",onChange:A})}),e.jsx(m.Button,{onClick:F,children:"更新服务器地址"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",inverted:j,children:"支付设置（当前仅支持易支付接口，默认使用上方服务器地址作为回调地址！）"}),e.jsxs(m.Group,{widths:"equal",children:[e.jsx(m.Input,{label:"支付地址，不填写则不启用在线支付",placeholder:"例如：https://yourdomain.com",value:u.PayAddress,name:"PayAddress",onChange:A}),e.jsx(m.Input,{label:"易支付商户ID",placeholder:"例如：0001",value:u.EpayId,name:"EpayId",onChange:A}),e.jsx(m.Input,{label:"易支付商户密钥",placeholder:"敏感信息不会发送到前端显示",value:u.EpayKey,name:"EpayKey",onChange:A})]}),e.jsxs(m.Group,{widths:"equal",children:[e.jsx(m.Input,{label:"回调地址，不填写则使用上方服务器地址作为回调地址",placeholder:"例如：https://yourdomain.com",value:u.CustomCallbackAddress,name:"CustomCallbackAddress",onChange:A}),e.jsx(m.Input,{label:"充值价格（x元/美金）",placeholder:"例如：7，就是7元/美金",value:u.Price,name:"Price",min:0,onChange:A}),e.jsx(m.Input,{label:"最低充值美元数量（以美金为单位，如果使用额度请自行换算！）",placeholder:"例如：2，就是最低充值2$",value:u.MinTopUp,name:"MinTopUp",min:1,onChange:A})]}),e.jsx(m.Group,{widths:"equal",children:e.jsx(m.TextArea,{label:"充值分组倍率",name:"TopupGroupRatio",onChange:A,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:u.TopupGroupRatio,placeholder:"为一个 JSON 文本，键为组名称，值为倍率"})}),e.jsx(m.Button,{onClick:P,children:"更新支付设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",inverted:j,children:"配置登录注册"}),e.jsxs(m.Group,{inline:!0,children:[e.jsx(m.Checkbox,{checked:u.PasswordLoginEnabled==="true",label:"允许通过密码进行登录",name:"PasswordLoginEnabled",onChange:A}),L&&e.jsxs(cu,{open:L,onClose:()=>C(!1),size:"tiny",style:{maxWidth:"450px"},children:[e.jsx(cu.Header,{children:"警告"}),e.jsx(cu.Content,{children:e.jsx("p",{children:"取消密码登录将导致所有未绑定其他登录方式的用户（包括管理员）无法通过密码登录，确认取消？"})}),e.jsxs(cu.Actions,{children:[e.jsx(Ne,{onClick:()=>C(!1),children:"取消"}),e.jsx(Ne,{color:"yellow",onClick:async()=>{C(!1),await D("PasswordLoginEnabled","false")},children:"确定"})]})]}),e.jsx(m.Checkbox,{checked:u.PasswordRegisterEnabled==="true",label:"允许通过密码进行注册",name:"PasswordRegisterEnabled",onChange:A}),e.jsx(m.Checkbox,{checked:u.EmailVerificationEnabled==="true",label:"通过密码注册时需要进行邮箱验证",name:"EmailVerificationEnabled",onChange:A}),e.jsx(m.Checkbox,{checked:u.GitHubOAuthEnabled==="true",label:"允许通过 GitHub 账户登录 & 注册",name:"GitHubOAuthEnabled",onChange:A}),e.jsx(m.Checkbox,{checked:u.WeChatAuthEnabled==="true",label:"允许通过微信登录 & 注册",name:"WeChatAuthEnabled",onChange:A}),e.jsx(m.Checkbox,{checked:u.TelegramOAuthEnabled==="true",label:"允许通过 Telegram 进行登录",name:"TelegramOAuthEnabled",onChange:A})]}),e.jsxs(m.Group,{inline:!0,children:[e.jsx(m.Checkbox,{checked:u.RegisterEnabled==="true",label:"允许新用户注册（此项为否时，新用户将无法以任何方式进行注册）",name:"RegisterEnabled",onChange:A}),e.jsx(m.Checkbox,{checked:u.TurnstileCheckEnabled==="true",label:"启用 Turnstile 用户校验",name:"TurnstileCheckEnabled",onChange:A})]}),e.jsx(ge,{}),e.jsxs(oe,{as:"h3",inverted:j,children:["配置邮箱域名白名单",e.jsx(oe.Subheader,{children:"用以防止恶意用户利用临时邮箱批量注册"})]}),e.jsx(m.Group,{widths:3,children:e.jsx(m.Checkbox,{label:"启用邮箱域名白名单",name:"EmailDomainRestrictionEnabled",onChange:A,checked:u.EmailDomainRestrictionEnabled==="true"})}),e.jsx(m.Group,{widths:3,children:e.jsx(m.Checkbox,{label:"启用邮箱别名限制（例如：ab.cd@gmail.com）",name:"EmailAliasRestrictionEnabled",onChange:A,checked:u.EmailAliasRestrictionEnabled==="true"})}),e.jsxs(m.Group,{widths:2,children:[e.jsx(m.Dropdown,{label:"允许的邮箱域名",placeholder:"允许的邮箱域名",name:"EmailDomainWhitelist",required:!0,fluid:!0,multiple:!0,selection:!0,onChange:A,value:u.EmailDomainWhitelist,autoComplete:"new-password",options:c}),e.jsx(m.Input,{label:"添加新的允许的邮箱域名",action:e.jsx(Ne,{type:"button",onClick:()=>{U()},children:"填入"}),onKeyDown:O=>{O.key==="Enter"&&U()},autoComplete:"new-password",placeholder:"输入新的允许的邮箱域名",value:I,onChange:(O,{value:g})=>{R(g)}})]}),e.jsx(m.Button,{onClick:q,children:"保存邮箱域名白名单设置"}),e.jsx(ge,{}),e.jsxs(oe,{as:"h3",inverted:j,children:["配置 SMTP",e.jsx(oe.Subheader,{children:"用以支持系统的邮件发送"})]}),e.jsxs(m.Group,{widths:3,children:[e.jsx(m.Input,{label:"SMTP 服务器地址",name:"SMTPServer",onChange:A,autoComplete:"new-password",value:u.SMTPServer,placeholder:"例如：smtp.qq.com"}),e.jsx(m.Input,{label:"SMTP 端口",name:"SMTPPort",onChange:A,autoComplete:"new-password",value:u.SMTPPort,placeholder:"默认: 587"}),e.jsx(m.Input,{label:"SMTP 账户",name:"SMTPAccount",onChange:A,autoComplete:"new-password",value:u.SMTPAccount,placeholder:"通常是邮箱地址"})]}),e.jsxs(m.Group,{widths:3,children:[e.jsx(m.Input,{label:"SMTP 发送者邮箱",name:"SMTPFrom",onChange:A,autoComplete:"new-password",value:u.SMTPFrom,placeholder:"通常和邮箱地址保持一致"}),e.jsx(m.Input,{label:"SMTP 访问凭证",name:"SMTPToken",onChange:A,type:"password",autoComplete:"new-password",checked:u.RegisterEnabled==="true",placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(m.Group,{widths:3,children:e.jsx(m.Checkbox,{label:"启用SMTP SSL（465端口强制开启）",name:"SMTPSSLEnabled",onChange:A,checked:u.SMTPSSLEnabled==="true"})}),e.jsx(m.Button,{onClick:M,children:"保存 SMTP 设置"}),e.jsx(ge,{}),e.jsxs(oe,{as:"h3",inverted:j,children:["配置 GitHub OAuth App",e.jsxs(oe.Subheader,{children:["用以支持通过 GitHub 进行登录注册，",e.jsx("a",{href:"https://github.com/settings/developers",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 GitHub OAuth App"]})]}),e.jsxs(mu,{children:["Homepage URL 填 ",e.jsx("code",{children:u.ServerAddress}),"，Authorization callback URL 填"," ",e.jsx("code",{children:`${u.ServerAddress}/oauth/github`})]}),e.jsxs(m.Group,{widths:3,children:[e.jsx(m.Input,{label:"GitHub Client ID",name:"GitHubClientId",onChange:A,autoComplete:"new-password",value:u.GitHubClientId,placeholder:"输入你注册的 GitHub OAuth APP 的 ID"}),e.jsx(m.Input,{label:"GitHub Client Secret",name:"GitHubClientSecret",onChange:A,type:"password",autoComplete:"new-password",value:u.GitHubClientSecret,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(m.Button,{onClick:k,children:"保存 GitHub OAuth 设置"}),e.jsx(ge,{}),e.jsxs(oe,{as:"h3",inverted:j,children:["配置 WeChat Server",e.jsxs(oe.Subheader,{children:["用以支持通过微信进行登录注册，",e.jsx("a",{href:"https://github.com/songquanpeng/wechat-server",target:"_blank",rel:"noreferrer",children:"点击此处"}),"了解 WeChat Server"]})]}),e.jsxs(m.Group,{widths:3,children:[e.jsx(m.Input,{label:"WeChat Server 服务器地址",name:"WeChatServerAddress",placeholder:"例如：https://yourdomain.com",onChange:A,autoComplete:"new-password",value:u.WeChatServerAddress}),e.jsx(m.Input,{label:"WeChat Server 访问凭证",name:"WeChatServerToken",type:"password",onChange:A,autoComplete:"new-password",value:u.WeChatServerToken,placeholder:"敏感信息不会发送到前端显示"}),e.jsx(m.Input,{label:"微信公众号二维码图片链接",name:"WeChatAccountQRCodeImageURL",onChange:A,autoComplete:"new-password",value:u.WeChatAccountQRCodeImageURL,placeholder:"输入一个图片链接"})]}),e.jsx(m.Button,{onClick:W,children:"保存 WeChat Server 设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",inverted:j,children:"配置 Telegram 登录"}),e.jsxs(m.Group,{inline:!0,children:[e.jsx(m.Input,{label:"Telegram Bot Token",name:"TelegramBotToken",onChange:A,value:u.TelegramBotToken,placeholder:"输入你的 Telegram Bot Token"}),e.jsx(m.Input,{label:"Telegram Bot 名称",name:"TelegramBotName",onChange:A,value:u.TelegramBotName,placeholder:"输入你的 Telegram Bot 名称"})]}),e.jsx(m.Button,{onClick:Q,children:"保存 Telegram 登录设置"}),e.jsx(ge,{}),e.jsxs(oe,{as:"h3",inverted:j,children:["配置 Turnstile",e.jsxs(oe.Subheader,{children:["用以支持用户校验，",e.jsx("a",{href:"https://dash.cloudflare.com/",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 Turnstile Sites，推荐选择 Invisible Widget Type"]})]}),e.jsxs(m.Group,{widths:3,children:[e.jsx(m.Input,{label:"Turnstile Site Key",name:"TurnstileSiteKey",onChange:A,autoComplete:"new-password",value:u.TurnstileSiteKey,placeholder:"输入你注册的 Turnstile Site Key"}),e.jsx(m.Input,{label:"Turnstile Secret Key",name:"TurnstileSecretKey",onChange:A,type:"password",autoComplete:"new-password",value:u.TurnstileSecretKey,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(m.Button,{onClick:X,children:"保存 Turnstile 设置"})]})})})},Es=()=>{let[u,t]=s.useState({Notice:"",SystemName:"",Logo:"",Footer:"",About:"",HomePageContent:""}),[l,a]=s.useState(!1);s.useState(!1),s.useState({tag_name:"",content:""});const o=async(F,P)=>{a(!0);const M=await _.put("/api/option/",{key:F,value:P}),{success:q,message:W}=M.data;q?t(k=>({...k,[F]:P})):p(W),a(!1)},[r,c]=s.useState({Notice:!1,SystemName:!1,Logo:!1,HomePageContent:!1,About:!1,Footer:!1}),y=async(F,P)=>{const M=P.target.id;t(q=>({...q,[M]:F}))},I=s.useRef(),R=async()=>{try{c(F=>({...F,Notice:!0})),await o("Notice",u.Notice),Z("公告已更新")}catch(F){console.error("公告更新失败",F),p("公告更新失败")}finally{c(F=>({...F,Notice:!1}))}},L=s.useRef(),C=async()=>{try{c(F=>({...F,SystemName:!0})),await o("SystemName",u.SystemName),Z("系统名称已更新")}catch(F){console.error("系统名称更新失败",F),p("系统名称更新失败")}finally{c(F=>({...F,SystemName:!1}))}},B=async()=>{try{c(F=>({...F,Logo:!0})),await o("Logo",u.Logo),Z("Logo 已更新")}catch(F){console.error("Logo 更新失败",F),p("Logo 更新失败")}finally{c(F=>({...F,Logo:!1}))}},j=async F=>{try{c(P=>({...P,HomePageContent:!0})),await o(F,u[F]),Z("首页内容已更新")}catch(P){console.error("首页内容更新失败",P),p("首页内容更新失败")}finally{c(P=>({...P,HomePageContent:!1}))}},h=async()=>{try{c(F=>({...F,About:!0})),await o("About",u.About),Z("关于内容已更新")}catch(F){console.error("关于内容更新失败",F),p("关于内容更新失败")}finally{c(F=>({...F,About:!1}))}},D=async()=>{try{c(F=>({...F,Footer:!0})),await o("Footer",u.Footer),Z("页脚内容已更新")}catch(F){console.error("页脚内容更新失败",F),p("页脚内容更新失败")}finally{c(F=>({...F,Footer:!1}))}},A=async()=>{const F=await _.get("/api/option/"),{success:P,message:M,data:q}=F.data;if(P){let W={};q.forEach(k=>{k.key in u&&(W[k.key]=k.value)}),t(W),I.current.setValues(W),L.current.setValues(W)}else p(M)};return s.useEffect(()=>{A()},[]),e.jsx(xt,{children:e.jsxs(Et,{span:24,children:[e.jsx(ue,{values:u,getFormApi:F=>I.current=F,style:{marginBottom:15},children:e.jsxs(ue.Section,{text:"通用设置",children:[e.jsx(ue.TextArea,{label:"公告",placeholder:"在此输入新的公告内容，支持 Markdown & HTML 代码",field:"Notice",onChange:y,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(v,{onClick:R,loading:r.Notice,children:"设置公告"})]})}),e.jsx(ue,{values:u,getFormApi:F=>L.current=F,style:{marginBottom:15},children:e.jsxs(ue.Section,{text:"个性化设置",children:[e.jsx(ue.Input,{label:"系统名称",placeholder:"在此输入系统名称",field:"SystemName",onChange:y}),e.jsx(v,{onClick:C,loading:r.SystemName,children:"设置系统名称"}),e.jsx(ue.Input,{label:"Logo 图片地址",placeholder:"在此输入 Logo 图片地址",field:"Logo",onChange:y}),e.jsx(v,{onClick:B,loading:r.Logo,children:"设置 Logo"}),e.jsx(ue.TextArea,{label:"首页内容",placeholder:"在此输入首页内容，支持 Markdown & HTML 代码，设置后首页的状态信息将不再显示。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为首页。",field:"HomePageContent",onChange:y,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(v,{onClick:()=>j("HomePageContent"),loading:r.HomePageContent,children:"设置首页内容"}),e.jsx(ue.TextArea,{label:"关于",placeholder:"在此输入新的关于内容，支持 Markdown & HTML 代码。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为关于页面。",field:"About",onChange:y,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(v,{onClick:h,loading:r.About,children:"设置关于"}),e.jsx(au,{fullMode:!1,type:"info",description:"移除 One API 的版权标识必须首先获得授权，项目维护需要花费大量精力，如果本项目对你有意义，请主动支持本项目。",closeIcon:null,style:{marginTop:15}}),e.jsx(ue.Input,{label:"页脚",placeholder:"在此输入新的页脚，留空则使用默认页脚，支持 HTML 代码",field:"Footer",onChange:y}),e.jsx(v,{onClick:D,loading:r.Footer,children:"设置页脚"})]})})]})})},Cs=()=>{var iu,ru,E,f,ee,ne,re,Ee,ke,ze,ou;const[u,t]=s.useContext(We);let l=Se();const[a,o]=s.useState({wechat_verification_code:"",email_verification_code:"",email:"",self_account_deletion_confirmation:"",set_new_password:"",set_new_password_confirmation:""}),[r,c]=s.useState({}),[y,I]=s.useState(!1),[R,L]=s.useState(!1),[C,B]=s.useState(!1),[j,h]=s.useState(!1),[D,A]=s.useState(!1),[F,P]=s.useState(""),[M,q]=s.useState(""),[W,k]=s.useState(!1),[Q,X]=s.useState(!1),[U,O]=s.useState(30),[g,K]=s.useState(""),[N,T]=s.useState(""),[n,i]=s.useState([]),[d,H]=s.useState(!1),[Y,b]=s.useState(0);s.useEffect(()=>{let $=localStorage.getItem("status");$&&($=JSON.parse($),c($),$.turnstile_check&&(A(!0),P($.turnstile_site_key))),le().then(de=>{console.log(u)}),x().then(),G().then(),b(du())},[]),s.useEffect(()=>{let $=null;return Q&&U>0?$=setInterval(()=>{O(U-1)},1e3):U===0&&(X(!1),O(30)),()=>clearInterval($)},[Q,U]);const J=($,de)=>{o(he=>({...he,[$]:de}))},w=async()=>{const $=await _.get("/api/user/token"),{success:de,message:he,data:Ie}=$.data;de?(T(Ie),await Re(Ie),Z("令牌已重置并已复制到剪贴板")):p(he)},G=async()=>{const $=await _.get("/api/user/aff"),{success:de,message:he,data:Ie}=$.data;if(de){let ot=`${window.location.origin}/register?aff=${Ie}`;K(ot)}else p(he)},le=async()=>{let $=await _.get("/api/user/self");const{success:de,message:he,data:Ie}=$.data;de?t({type:"login",payload:Ie}):p(he)},x=async()=>{let $=await _.get("/api/user/models");const{success:de,message:he,data:Ie}=$.data;de?(i(Ie),console.log(Ie)):p(he)},z=async $=>{$.target.select(),await Re($.target.value),Z("邀请链接已复制到剪切板")},se=async $=>{$.target.select(),await Re($.target.value),Z("系统令牌已复制到剪切板")},me=async()=>{if(a.self_account_deletion_confirmation!==u.user.username){p("请输入你的账户名以确认删除！");return}const $=await _.delete("/api/user/self"),{success:de,message:he}=$.data;de?(Z("账户已删除！"),await _.get("/api/user/logout"),t({type:"logout"}),localStorage.removeItem("user"),l("/login")):p(he)},pe=async()=>{if(a.wechat_verification_code==="")return;const $=await _.get(`/api/oauth/wechat/bind?code=${a.wechat_verification_code}`),{success:de,message:he}=$.data;de?(Z("微信账户绑定成功！"),L(!1)):p(he)},Ce=async()=>{if(a.set_new_password!==a.set_new_password_confirmation){p("两次输入的密码不一致！");return}const $=await _.put("/api/user/self",{password:a.set_new_password}),{success:de,message:he}=$.data;de?(Z("密码修改成功！"),L(!1)):p(he),I(!1)},Ve=async()=>{if(Y<du()){p("划转金额最低为"+xe(du()));return}const $=await _.post("/api/user/aff_transfer",{quota:Y}),{success:de,message:he}=$.data;de?(Z(he),H(!1),le().then()):p(he)},Ye=async()=>{if(a.email===""){p("请输入邮箱！");return}if(X(!0),D&&M===""){ye("请稍后几秒重试，Turnstile 正在检查用户环境！");return}k(!0);const $=await _.get(`/api/verification?email=${a.email}&turnstile=${M}`),{success:de,message:he}=$.data;de?Z("验证码发送成功，请检查邮箱！"):p(he),k(!1)},Ze=async()=>{if(a.email_verification_code===""){p("请输入邮箱验证码！");return}k(!0);const $=await _.get(`/api/oauth/email/bind?email=${a.email}&code=${a.email_verification_code}`),{success:de,message:he}=$.data;de?(Z("邮箱账户绑定成功！"),B(!1),u.user.email=a.email):p(he),k(!1)},ve=()=>u.user?u.user.username:"null",Ke=()=>{H(!1)},Cu=async $=>{await Re($)?Z("已复制："+$):je.error({title:"无法复制到剪贴板，请手动复制",content:$})};return e.jsx("div",{children:e.jsx(ae,{children:e.jsxs(ae.Content,{children:[e.jsxs(je,{title:"请输入要划转的数量",visible:d,onOk:Ve,onCancel:Ke,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("div",{style:{marginTop:20},children:[e.jsx(V.Text,{children:`可用额度${uu((iu=u==null?void 0:u.user)==null?void 0:iu.aff_quota)}`}),e.jsx(te,{style:{marginTop:5},value:(ru=u==null?void 0:u.user)==null?void 0:ru.aff_quota,disabled:!0})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(V.Text,{children:`划转额度${uu(Y)} 最低`+xe(du())}),e.jsx("div",{children:e.jsx(yu,{min:0,style:{marginTop:5},value:Y,onChange:$=>b($),disabled:!1})})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsxs(qe,{title:e.jsx(qe.Meta,{avatar:e.jsx(ku,{size:"default",color:tu(ve()),style:{marginRight:4},children:typeof ve()=="string"&&ve().slice(0,1)}),title:e.jsx(V.Text,{children:ve()}),description:et()?e.jsx(S,{color:"red",children:"管理员"}):e.jsx(S,{color:"blue",children:"普通用户"})}),headerExtraContent:e.jsx(e.Fragment,{children:e.jsxs(ce,{vertical:!0,align:"start",children:[e.jsx(S,{color:"green",children:"ID: "+((E=u==null?void 0:u.user)==null?void 0:E.id)}),e.jsx(S,{color:"blue",children:(f=u==null?void 0:u.user)==null?void 0:f.group})]})}),footer:e.jsxs(Me,{row:!0,children:[e.jsx(Me.Item,{itemKey:"当前余额",children:xe((ee=u==null?void 0:u.user)==null?void 0:ee.quota)}),e.jsx(Me.Item,{itemKey:"历史消耗",children:xe((ne=u==null?void 0:u.user)==null?void 0:ne.used_quota)}),e.jsx(Me.Item,{itemKey:"请求次数",children:(re=u.user)==null?void 0:re.request_count})]}),children:[e.jsx(V.Title,{heading:6,children:"可用模型"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ce,{wrap:!0,children:n.map($=>e.jsx(S,{color:"cyan",onClick:()=>{Cu($)},children:$},$))})})]}),e.jsxs(qe,{footer:e.jsxs("div",{children:[e.jsx(V.Text,{children:"邀请链接"}),e.jsx(te,{style:{marginTop:10},value:g,onClick:z,readOnly:!0})]}),children:[e.jsx(V.Title,{heading:6,children:"邀请信息"}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(Me,{row:!0,children:[e.jsxs(Me.Item,{itemKey:"待使用收益",children:[e.jsx("span",{style:{color:"rgba(var(--semi-red-5), 1)"},children:xe((Ee=u==null?void 0:u.user)==null?void 0:Ee.aff_quota)}),e.jsx(v,{type:"secondary",onClick:()=>H(!0),size:"small",style:{marginLeft:10},children:"划转"})]}),e.jsx(Me.Item,{itemKey:"总收益",children:xe((ke=u==null?void 0:u.user)==null?void 0:ke.aff_history_quota)}),e.jsx(Me.Item,{itemKey:"邀请人数",children:(ze=u==null?void 0:u.user)==null?void 0:ze.aff_count})]})})]}),e.jsxs(qe,{children:[e.jsx(V.Title,{heading:6,children:"个人信息"}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(V.Text,{strong:!0,children:"邮箱"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(te,{value:u.user&&u.user.email!==""?u.user.email:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(v,{onClick:()=>{B(!0)},children:u.user&&u.user.email!==""?"修改绑定":"绑定邮箱"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(V.Text,{strong:!0,children:"微信"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(te,{value:u.user&&u.user.wechat_id!==""?"已绑定":"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(v,{disabled:u.user&&u.user.wechat_id!==""||!r.wechat_login,children:r.wechat_login?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(V.Text,{strong:!0,children:"GitHub"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(te,{value:u.user&&u.user.github_id!==""?u.user.github_id:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(v,{onClick:()=>{nt(r.github_client_id)},disabled:u.user&&u.user.github_id!==""||!r.github_oauth,children:r.github_oauth?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(V.Text,{strong:!0,children:"Telegram"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(te,{value:u.user&&u.user.telegram_id!==""?u.user.telegram_id:"未绑定",readonly:!0})}),e.jsx("div",{children:r.telegram_oauth?u.user.telegram_id!==""?e.jsx(v,{disabled:!0,children:"已绑定"}):e.jsx(Yu,{dataAuthUrl:"/api/oauth/telegram/bind",botName:r.telegram_bot_name}):e.jsx(v,{disabled:!0,children:"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(ce,{children:[e.jsx(v,{onClick:w,children:"生成系统访问令牌"}),e.jsx(v,{onClick:()=>{I(!0)},children:"修改密码"}),e.jsx(v,{type:"danger",onClick:()=>{h(!0)},children:"删除个人账户"})]}),N&&e.jsx(te,{readOnly:!0,value:N,onClick:se,style:{marginTop:"10px"}}),r.wechat_login&&e.jsx(v,{onClick:()=>{L(!0)},children:"绑定微信账号"}),e.jsxs(je,{onCancel:()=>L(!1),visible:R,size:"small",children:[e.jsx(Ct,{src:r.wechat_qrcode}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(te,{placeholder:"验证码",name:"wechat_verification_code",value:a.wechat_verification_code,onChange:$=>J("wechat_verification_code",$)}),e.jsx(v,{color:"",fluid:!0,size:"large",onClick:pe,children:"绑定"})]})]})]}),e.jsxs(je,{onCancel:()=>B(!1),onOk:Ze,visible:C,size:"small",centered:!0,maskClosable:!1,children:[e.jsx(V.Title,{heading:6,children:"绑定邮箱地址"}),e.jsxs("div",{style:{marginTop:20,display:"flex",justifyContent:"space-between"},children:[e.jsx(te,{fluid:!0,placeholder:"输入邮箱地址",onChange:$=>J("email",$),name:"email",type:"email"}),e.jsx(v,{onClick:Ye,disabled:Q||W,children:Q?`重新发送 (${U})`:"获取验证码"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(te,{fluid:!0,placeholder:"验证码",name:"email_verification_code",value:a.email_verification_code,onChange:$=>J("email_verification_code",$)})}),D?e.jsx(Qe,{sitekey:F,onVerify:$=>{q($)}}):e.jsx(e.Fragment,{})]}),e.jsxs(je,{onCancel:()=>h(!1),visible:j,size:"small",centered:!0,onOk:me,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(au,{type:"danger",description:"您正在删除自己的帐户，将清空所有数据且不可恢复",closeIcon:null})}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(te,{placeholder:`输入你的账户名 ${(ou=u==null?void 0:u.user)==null?void 0:ou.username} 以确认删除`,name:"self_account_deletion_confirmation",value:a.self_account_deletion_confirmation,onChange:$=>J("self_account_deletion_confirmation",$)}),D?e.jsx(Qe,{sitekey:F,onVerify:$=>{q($)}}):e.jsx(e.Fragment,{})]})]}),e.jsx(je,{onCancel:()=>I(!1),visible:y,size:"small",centered:!0,onOk:Ce,children:e.jsxs("div",{style:{marginTop:20},children:[e.jsx(te,{name:"set_new_password",placeholder:"新密码",value:a.set_new_password,onChange:$=>J("set_new_password",$)}),e.jsx(te,{style:{marginTop:20},name:"set_new_password_confirmation",placeholder:"确认新密码",value:a.set_new_password_confirmation,onChange:$=>J("set_new_password_confirmation",$)}),D?e.jsx(Qe,{sitekey:F,onVerify:$=>{q($)}}):e.jsx(e.Fragment,{})]})})]})]})})})},js=()=>{let u=new Date,[t,l]=s.useState({QuotaForNewUser:0,QuotaForInviter:0,QuotaForInvitee:0,QuotaRemindThreshold:0,PreConsumedQuota:0,StreamCacheQueueLength:0,ModelRatio:"",ModelPrice:"",GroupRatio:"",TopUpLink:"",ChatLink:"",ChatLink2:"",QuotaPerUnit:0,AutomaticDisableChannelEnabled:"",AutomaticEnableChannelEnabled:"",ChannelDisableThreshold:0,LogConsumeEnabled:"",DisplayInCurrencyEnabled:"",DisplayTokenStatEnabled:"",CheckSensitiveEnabled:"",CheckSensitiveOnPromptEnabled:"",CheckSensitiveOnCompletionEnabled:"",StopOnSensitiveEnabled:"",SensitiveWords:"",MjNotifyEnabled:"",MjModeClearEnabled:"",MjForwardUrlEnabled:"",DrawingEnabled:"",DataExportEnabled:"",DataExportDefaultTime:"hour",DataExportInterval:5,DefaultCollapseSidebar:"",RetryTimes:0});const[a,o]=s.useState({});let[r,c]=s.useState(!1),[y,I]=s.useState(we(u.getTime()/1e3-30*24*3600));const R=[{key:"hour",text:"小时",value:"hour"},{key:"day",text:"天",value:"day"},{key:"week",text:"周",value:"week"}],L=async()=>{const F=await _.get("/api/option/"),{success:P,message:M,data:q}=F.data;if(P){let W={};q.forEach(k=>{(k.key==="ModelRatio"||k.key==="GroupRatio"||k.key==="ModelPrice")&&(k.value=JSON.stringify(JSON.parse(k.value),null,2)),W[k.key]=k.value}),l(W),o(W)}else p(M)},B=Iu()==="dark";s.useEffect(()=>{L().then()},[]);const j=async(F,P)=>{c(!0),F.endsWith("Enabled")&&(P=t[F]==="true"?"false":"true"),F==="DefaultCollapseSidebar"&&(P=t[F]==="true"?"false":"true"),console.log(F,P);const M=await _.put("/api/option/",{key:F,value:P}),{success:q,message:W}=M.data;q?l(k=>({...k,[F]:P})):p(W),c(!1)},h=async(F,{name:P,value:M})=>{P.endsWith("Enabled")||P==="DataExportInterval"||P==="DataExportDefaultTime"||P==="DefaultCollapseSidebar"?(P==="DataExportDefaultTime"?localStorage.setItem("data_export_default_time",M):P==="MjNotifyEnabled"&&localStorage.setItem("mj_notify_enabled",M),await j(P,M)):l(q=>({...q,[P]:M}))},D=async F=>{switch(F){case"monitor":a.ChannelDisableThreshold!==t.ChannelDisableThreshold&&await j("ChannelDisableThreshold",t.ChannelDisableThreshold),a.QuotaRemindThreshold!==t.QuotaRemindThreshold&&await j("QuotaRemindThreshold",t.QuotaRemindThreshold);break;case"ratio":if(a.ModelRatio!==t.ModelRatio){if(!Xe(t.ModelRatio)){p("模型倍率不是合法的 JSON 字符串");return}await j("ModelRatio",t.ModelRatio)}if(a.GroupRatio!==t.GroupRatio){if(!Xe(t.GroupRatio)){p("分组倍率不是合法的 JSON 字符串");return}await j("GroupRatio",t.GroupRatio)}if(a.ModelPrice!==t.ModelPrice){if(!Xe(t.ModelPrice)){p("模型固定价格不是合法的 JSON 字符串");return}await j("ModelPrice",t.ModelPrice)}break;case"words":a.SensitiveWords!==t.SensitiveWords&&await j("SensitiveWords",t.SensitiveWords);break;case"quota":a.QuotaForNewUser!==t.QuotaForNewUser&&await j("QuotaForNewUser",t.QuotaForNewUser),a.QuotaForInvitee!==t.QuotaForInvitee&&await j("QuotaForInvitee",t.QuotaForInvitee),a.QuotaForInviter!==t.QuotaForInviter&&await j("QuotaForInviter",t.QuotaForInviter),a.PreConsumedQuota!==t.PreConsumedQuota&&await j("PreConsumedQuota",t.PreConsumedQuota);break;case"general":a.TopUpLink!==t.TopUpLink&&await j("TopUpLink",t.TopUpLink),a.ChatLink!==t.ChatLink&&await j("ChatLink",t.ChatLink),a.ChatLink2!==t.ChatLink2&&await j("ChatLink2",t.ChatLink2),a.QuotaPerUnit!==t.QuotaPerUnit&&await j("QuotaPerUnit",t.QuotaPerUnit),a.RetryTimes!==t.RetryTimes&&await j("RetryTimes",t.RetryTimes);break}},A=async()=>{console.log(t);const F=await _.delete(`/api/log/?target_timestamp=${Date.parse(y)/1e3}`),{success:P,message:M,data:q}=F.data;if(P){Z(`${q} 条日志已清理！`);return}p("日志清理失败："+M)};return e.jsx(Te,{columns:1,children:e.jsx(Te.Column,{children:e.jsxs(m,{loading:r,inverted:B,children:[e.jsx(oe,{as:"h3",inverted:B,children:"通用设置"}),e.jsxs(m.Group,{widths:4,children:[e.jsx(m.Input,{label:"充值链接",name:"TopUpLink",onChange:h,autoComplete:"new-password",value:t.TopUpLink,type:"link",placeholder:"例如发卡网站的购买链接"}),e.jsx(m.Input,{label:"默认聊天页面链接",name:"ChatLink",onChange:h,autoComplete:"new-password",value:t.ChatLink,type:"link",placeholder:"例如 ChatGPT Next Web 的部署地址"}),e.jsx(m.Input,{label:"聊天页面2链接",name:"ChatLink2",onChange:h,autoComplete:"new-password",value:t.ChatLink2,type:"link",placeholder:"例如 ChatGPT Web & Midjourney 的部署地址"}),e.jsx(m.Input,{label:"单位美元额度",name:"QuotaPerUnit",onChange:h,autoComplete:"new-password",value:t.QuotaPerUnit,type:"number",step:"0.01",placeholder:"一单位货币能兑换的额度"}),e.jsx(m.Input,{label:"失败重试次数",name:"RetryTimes",type:"number",step:"1",min:"0",onChange:h,autoComplete:"new-password",value:t.RetryTimes,placeholder:"失败重试次数"})]}),e.jsxs(m.Group,{inline:!0,children:[e.jsx(m.Checkbox,{checked:t.DisplayInCurrencyEnabled==="true",label:"以货币形式显示额度",name:"DisplayInCurrencyEnabled",onChange:h}),e.jsx(m.Checkbox,{checked:t.DisplayTokenStatEnabled==="true",label:"Billing 相关 API 显示令牌额度而非用户额度",name:"DisplayTokenStatEnabled",onChange:h}),e.jsx(m.Checkbox,{checked:t.DefaultCollapseSidebar==="true",label:"默认折叠侧边栏",name:"DefaultCollapseSidebar",onChange:h})]}),e.jsx(m.Button,{onClick:()=>{D("general").then()},children:"保存通用设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",inverted:B,children:"绘图设置"}),e.jsxs(m.Group,{inline:!0,children:[e.jsx(m.Checkbox,{checked:t.DrawingEnabled==="true",label:"启用绘图功能",name:"DrawingEnabled",onChange:h}),e.jsx(m.Checkbox,{checked:t.MjNotifyEnabled==="true",label:"允许回调（会泄露服务器ip地址）",name:"MjNotifyEnabled",onChange:h}),e.jsx(m.Checkbox,{checked:t.MjForwardUrlEnabled==="true",label:"开启之后将上游地址替换为服务器地址",name:"MjForwardUrlEnabled",onChange:h}),e.jsx(m.Checkbox,{checked:t.MjModeClearEnabled==="true",label:"开启之后会清除用户提示词中的--fast、--relax以及--turbo参数",name:"MjModeClearEnabled",onChange:h})]}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",inverted:B,children:"屏蔽词过滤设置"}),e.jsx(m.Group,{inline:!0,children:e.jsx(m.Checkbox,{checked:t.CheckSensitiveEnabled==="true",label:"启用屏蔽词过滤功能",name:"CheckSensitiveEnabled",onChange:h})}),e.jsx(m.Group,{inline:!0,children:e.jsx(m.Checkbox,{checked:t.CheckSensitiveOnPromptEnabled==="true",label:"启用prompt检查",name:"CheckSensitiveOnPromptEnabled",onChange:h})}),e.jsx(m.Group,{widths:"equal",children:e.jsx(m.TextArea,{label:"屏蔽词列表，一行一个屏蔽词，不需要符号分割",name:"SensitiveWords",onChange:h,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},value:t.SensitiveWords,placeholder:"一行一个屏蔽词"})}),e.jsx(m.Button,{onClick:()=>{D("words").then()},children:"保存屏蔽词设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",inverted:B,children:"日志设置"}),e.jsx(m.Group,{inline:!0,children:e.jsx(m.Checkbox,{checked:t.LogConsumeEnabled==="true",label:"启用额度消费日志记录",name:"LogConsumeEnabled",onChange:h})}),e.jsx(m.Group,{widths:4,children:e.jsx(m.Input,{label:"目标时间",value:y,type:"datetime-local",name:"history_timestamp",onChange:(F,{name:P,value:M})=>{I(M)}})}),e.jsx(m.Button,{onClick:()=>{A().then()},children:"清理历史日志"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",inverted:B,children:"数据看板"}),e.jsx(m.Checkbox,{checked:t.DataExportEnabled==="true",label:"启用数据看板（实验性）",name:"DataExportEnabled",onChange:h}),e.jsxs(m.Group,{children:[e.jsx(m.Input,{label:"数据看板更新间隔（分钟，设置过短会影响数据库性能）",name:"DataExportInterval",type:"number",step:"1",min:"1",onChange:h,autoComplete:"new-password",value:t.DataExportInterval,placeholder:"数据看板更新间隔（分钟，设置过短会影响数据库性能）"}),e.jsx(m.Select,{label:"数据看板默认时间粒度（仅修改展示粒度，统计精确到小时）",options:R,name:"DataExportDefaultTime",onChange:h,autoComplete:"new-password",value:t.DataExportDefaultTime,placeholder:"数据看板默认时间粒度"})]}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",inverted:B,children:"监控设置"}),e.jsxs(m.Group,{widths:3,children:[e.jsx(m.Input,{label:"最长响应时间",name:"ChannelDisableThreshold",onChange:h,autoComplete:"new-password",value:t.ChannelDisableThreshold,type:"number",min:"0",placeholder:"单位秒，当运行通道全部测试时，超过此时间将自动禁用通道"}),e.jsx(m.Input,{label:"额度提醒阈值",name:"QuotaRemindThreshold",onChange:h,autoComplete:"new-password",value:t.QuotaRemindThreshold,type:"number",min:"0",placeholder:"低于此额度时将发送邮件提醒用户"})]}),e.jsxs(m.Group,{inline:!0,children:[e.jsx(m.Checkbox,{checked:t.AutomaticDisableChannelEnabled==="true",label:"失败时自动禁用通道",name:"AutomaticDisableChannelEnabled",onChange:h}),e.jsx(m.Checkbox,{checked:t.AutomaticEnableChannelEnabled==="true",label:"成功时自动启用通道",name:"AutomaticEnableChannelEnabled",onChange:h})]}),e.jsx(m.Button,{onClick:()=>{D("monitor").then()},children:"保存监控设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",inverted:B,children:"额度设置"}),e.jsxs(m.Group,{widths:4,children:[e.jsx(m.Input,{label:"新用户初始额度",name:"QuotaForNewUser",onChange:h,autoComplete:"new-password",value:t.QuotaForNewUser,type:"number",min:"0",placeholder:"例如：100"}),e.jsx(m.Input,{label:"请求预扣费额度",name:"PreConsumedQuota",onChange:h,autoComplete:"new-password",value:t.PreConsumedQuota,type:"number",min:"0",placeholder:"请求结束后多退少补"}),e.jsx(m.Input,{label:"邀请新用户奖励额度",name:"QuotaForInviter",onChange:h,autoComplete:"new-password",value:t.QuotaForInviter,type:"number",min:"0",placeholder:"例如：2000"}),e.jsx(m.Input,{label:"新用户使用邀请码奖励额度",name:"QuotaForInvitee",onChange:h,autoComplete:"new-password",value:t.QuotaForInvitee,type:"number",min:"0",placeholder:"例如：1000"})]}),e.jsx(m.Button,{onClick:()=>{D("quota").then()},children:"保存额度设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",inverted:B,children:"倍率设置"}),e.jsx(m.Group,{widths:"equal",children:e.jsx(m.TextArea,{label:"模型固定价格（一次调用消耗多少刀，优先级大于模型倍率）",name:"ModelPrice",onChange:h,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:t.ModelPrice,placeholder:'为一个 JSON 文本，键为模型名称，值为一次调用消耗多少刀，比如 "gpt-4-gizmo-*": 0.1，一次消耗0.1刀'})}),e.jsx(m.Group,{widths:"equal",children:e.jsx(m.TextArea,{label:"模型倍率",name:"ModelRatio",onChange:h,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:t.ModelRatio,placeholder:"为一个 JSON 文本，键为模型名称，值为倍率"})}),e.jsx(m.Group,{widths:"equal",children:e.jsx(m.TextArea,{label:"分组倍率",name:"GroupRatio",onChange:h,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:t.GroupRatio,placeholder:"为一个 JSON 文本，键为分组名称，值为倍率"})}),e.jsx(m.Button,{onClick:()=>{D("ratio").then()},children:"保存倍率设置"})]})})})},fs=()=>{const u=Se(),t=ht(),[l,a]=s.useState("1");let o=[{tab:"个人设置",content:e.jsx(Cs,{}),itemKey:"personal"}];et()&&(o.push({tab:"运营设置",content:e.jsx(js,{}),itemKey:"operation"}),o.push({tab:"系统设置",content:e.jsx(xs,{}),itemKey:"system"}),o.push({tab:"其他设置",content:e.jsx(Es,{}),itemKey:"other"}));const r=c=>{a(c),u(`?tab=${c}`)};return s.useEffect(()=>{const y=new URLSearchParams(window.location.search).get("tab");y?a(y):r("personal")},[t.search]),e.jsx("div",{children:e.jsx(ae,{children:e.jsx(ae.Content,{children:e.jsx(jt,{type:"line",activeKey:l,onChange:c=>r(c),children:o.map(c=>e.jsx(ft,{itemKey:c.itemKey,tab:c.tab,children:l===c.itemKey&&c.content},c.itemKey))})})})})},ys=()=>{const[u,t]=s.useState({email:""}),{email:l}=u,[a,o]=s.useState(!1),[r,c]=s.useState(!1),[y,I]=s.useState(""),[R,L]=s.useState(""),[C,B]=s.useState(!1),[j,h]=s.useState(30);s.useEffect(()=>{let F=null;return C&&j>0?F=setInterval(()=>{h(j-1)},1e3):j===0&&(B(!1),h(30)),()=>clearInterval(F)},[C,j]);function D(F){const{name:P,value:M}=F.target;t(q=>({...q,[P]:M}))}async function A(F){if(B(!0),!l)return;if(r&&R===""){ye("请稍后几秒重试，Turnstile 正在检查用户环境！");return}o(!0);const P=await _.get(`/api/reset_password?email=${l}&turnstile=${R}`),{success:M,message:q}=P.data;M?(Z("重置邮件发送成功，请检查邮箱！"),t({...u,email:""})):p(q),o(!1)}return e.jsx(Te,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(Te.Column,{style:{maxWidth:450},children:[e.jsxs(oe,{as:"h2",color:"",textAlign:"center",children:[e.jsx(_u,{src:"/logo.png"})," 密码重置"]}),e.jsx(m,{size:"large",children:e.jsxs(gu,{children:[e.jsx(m.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:l,onChange:D}),r?e.jsx(Qe,{sitekey:y,onVerify:F=>{L(F)}}):e.jsx(e.Fragment,{}),e.jsx(Ne,{color:"green",fluid:!0,size:"large",onClick:A,loading:a,disabled:C,children:C?`重试 (${j})`:"提交"})]})})]})})},Bs=()=>{const[u,t]=vu(),[l,a]=s.useContext(We),[o,r]=s.useState("处理中...");s.useState(!0);let c=Se();const y=async(I,R,L)=>{const C=await _.get(`/api/oauth/github?code=${I}&state=${R}`),{success:B,message:j,data:h}=C.data;if(B)j==="bind"?(Z("绑定成功！"),c("/setting")):(a({type:"login",payload:h}),localStorage.setItem("user",JSON.stringify(h)),Z("登录成功！"),c("/"));else{if(p(j),L===0){r("操作失败，重定向至登录界面中..."),c("/setting");return}L++,r(`出现错误，第 ${L} 次重试中...`),await new Promise(D=>setTimeout(D,L*2e3)),await y(I,R,L)}};return s.useEffect(()=>{let I=u.get("code"),R=u.get("state");y(I,R,0).then()},[]),e.jsx(gu,{style:{minHeight:"300px"},children:e.jsx($t,{active:!0,inverted:!0,children:e.jsx(Nt,{size:"large",children:o})})})},Ds=()=>{const[u,t]=s.useState({email:"",token:""}),{email:l,token:a}=u,[o,r]=s.useState(!1),[c,y]=s.useState(!1),[I,R]=s.useState(30),[L,C]=s.useState(""),[B,j]=vu();s.useEffect(()=>{let D=B.get("token"),A=B.get("email");t({token:D,email:A})},[]),s.useEffect(()=>{let D=null;return c&&I>0?D=setInterval(()=>{R(I-1)},1e3):I===0&&(y(!1),R(30)),()=>clearInterval(D)},[c,I]);async function h(D){if(y(!0),!l)return;r(!0);const A=await _.post("/api/user/reset",{email:l,token:a}),{success:F,message:P}=A.data;if(F){let M=A.data.data;C(M),await Re(M),Ou(`新密码已复制到剪贴板：${M}`)}else p(P);r(!1)}return e.jsx(Te,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(Te.Column,{style:{maxWidth:450},children:[e.jsxs(oe,{as:"h2",color:"",textAlign:"center",children:[e.jsx(_u,{src:"/logo.png"})," 密码重置确认"]}),e.jsx(m,{size:"large",children:e.jsxs(gu,{children:[e.jsx(m.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:l,readOnly:!0}),L&&e.jsx(m.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"新密码",name:"newPassword",value:L,readOnly:!0,onClick:D=>{D.target.select(),navigator.clipboard.writeText(L),Ou(`密码已复制到剪贴板：${L}`)}}),e.jsx(Ne,{color:"green",fluid:!0,size:"large",onClick:h,loading:o,disabled:c,children:c?"密码重置完成":"提交"})]})})]})})},Nu={"gpt-3.5-turbo-0301":"gpt-3.5-turbo","gpt-4-0314":"gpt-4","gpt-4-32k-0314":"gpt-4-32k"};function As(u){switch(u){case 15:return"按照如下格式输入：APIKey|SecretKey";case 18:return"按照如下格式输入：APPID|APISecret|APIKey";case 22:return"按照如下格式输入：APIKey-AppId，例如：fastgpt-0sp2gtvfdgyi4k30jwlgwf1i-64f335d84283f05518e9e041";case 23:return"按照如下格式输入：AppId|SecretId|SecretKey";default:return"请输入渠道对应的鉴权密钥"}}const Su=u=>{Se();const t=u.editingChannel.id,l=t!==void 0,[a,o]=s.useState(l),r=()=>{u.handleClose()},c={name:"",type:1,key:"",openai_organization:"",base_url:"",other:"",model_mapping:"",models:[],auto_ban:1,test_model:"",groups:["default"]},[y,I]=s.useState(!1),[R,L]=s.useState(!0),[C,B]=s.useState(c),[j,h]=s.useState([]),[D,A]=s.useState([]),[F,P]=s.useState([]),[M,q]=s.useState([]),[W,k]=s.useState([]),[Q,X]=s.useState(""),U=(n,i)=>{if(B(d=>({...d,[n]:i})),n==="type"&&C.models.length===0){let d=[];switch(i){case 14:d=["claude-instant-1.2","claude-2","claude-2.0","claude-2.1","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"];break;case 11:d=["PaLM-2"];break;case 15:d=["ERNIE-Bot","ERNIE-Bot-turbo","ERNIE-Bot-4","Embedding-V1"];break;case 17:d=["qwen-turbo","qwen-plus","qwen-max","qwen-max-longcontext","text-embedding-v1"];break;case 16:d=["chatglm_pro","chatglm_std","chatglm_lite"];break;case 18:d=["SparkDesk","SparkDesk-v1.1","SparkDesk-v2.1","SparkDesk-v3.1","SparkDesk-v3.5"];break;case 19:d=["360GPT_S2_V9","embedding-bert-512-v1","embedding_s1_v1","semantic_similarity_s1_v1"];break;case 23:d=["hunyuan"];break;case 24:d=["gemini-pro","gemini-pro-vision"];break;case 25:d=["moonshot-v1-8k","moonshot-v1-32k","moonshot-v1-128k"];break;case 26:d=["glm-4","glm-4v","glm-3-turbo"];break;case 31:d=["yi-34b-chat-0205","yi-34b-chat-200k","yi-vl-plus"];break;case 2:d=["mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe"];break;case 5:d=["swap_face","mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe","mj_zoom","mj_shorten","mj_modal","mj_inpaint","mj_custom_zoom","mj_high_variation","mj_low_variation","mj_pan"];break}B(H=>({...H,models:d}))}},O=async()=>{o(!0);let n=await _.get(`/api/channel/${t}`);if(n===void 0)return;const{success:i,message:d,data:H}=n.data;i?(H.models===""?H.models=[]:H.models=H.models.split(","),H.group===""?H.groups=[]:H.groups=H.group.split(","),H.model_mapping!==""&&(H.model_mapping=JSON.stringify(JSON.parse(H.model_mapping),null,2)),B(H),H.auto_ban===0?L(!1):L(!0)):p(d),o(!1)},g=async()=>{try{let n=await _.get("/api/channel/models");if(n===void 0)return;let i=n.data.data.map(d=>({label:d.id,value:d.id}));h(i),k(n.data.data.map(d=>d.id)),q(n.data.data.filter(d=>d.id.startsWith("gpt-3")||d.id.startsWith("text-")).map(d=>d.id))}catch(n){p(n.message)}},K=async()=>{try{let n=await _.get("/api/group/");if(n===void 0)return;P(n.data.data.map(i=>({label:i,value:i})))}catch(n){p(n.message)}};s.useEffect(()=>{let n=[...j];C.models.forEach(i=>{n.find(d=>d.key===i)||n.push({label:i,value:i})}),A(n)},[j,C.models]),s.useEffect(()=>{g().then(),K().then(),l?O().then(()=>{}):B(c)},[u.editingChannel.id]);const N=async()=>{if(!l&&(C.name===""||C.key==="")){ye("请填写渠道名称和渠道密钥！");return}if(C.models.length===0){ye("请至少选择一个模型！");return}if(C.model_mapping!==""&&!Xe(C.model_mapping)){ye("模型映射必须是合法的 JSON 格式！");return}let n={...C};n.base_url&&n.base_url.endsWith("/")&&(n.base_url=n.base_url.slice(0,n.base_url.length-1)),n.type===3&&n.other===""&&(n.other="2023-06-01-preview"),n.type===18&&n.other===""&&(n.other="v2.1");let i;if(!Array.isArray(n.models)){p("提交失败，请勿重复提交！"),r();return}n.auto_ban=R?1:0,n.models=n.models.join(","),n.group=n.groups.join(","),l?i=await _.put("/api/channel/",{...n,id:parseInt(t)}):i=await _.post("/api/channel/",n);const{success:d,message:H}=i.data;d?(l?Z("渠道更新成功！"):(Z("渠道创建成功！"),B(c)),u.refresh(),u.handleClose()):p(H)},T=()=>{if(Q.trim()==="")return;if(C.models.includes(Q))return p("该模型已存在！");let n=[...C.models];n.push(Q);let i=[];i.push({key:Q,text:Q,value:Q}),A(d=>[...d,...i]),X(""),U("models",n)};return e.jsx(e.Fragment,{children:e.jsx(nu,{maskClosable:!1,placement:l?"right":"left",title:e.jsx(Ge,{level:3,children:l?"更新渠道信息":"创建新的渠道"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(ce,{children:[e.jsx(v,{theme:"solid",size:"large",onClick:N,children:"提交"}),e.jsx(v,{theme:"solid",size:"large",type:"tertiary",onClick:r,children:"取消"})]})}),closeIcon:null,onCancel:()=>r(),width:Be()?"100%":600,children:e.jsxs(Ue,{spinning:a,children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"类型："})}),e.jsx(Ae,{name:"type",required:!0,optionList:hu,value:C.type,onChange:n=>U("type",n),style:{width:"50%"}}),C.type===3&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(au,{type:"warning",description:e.jsxs(e.Fragment,{children:["注意，",e.jsx("strong",{children:"模型部署名称必须和模型名称保持一致"}),"，因为 One API 会把请求体中的 model 参数替换为你的部署名称（模型名称中的点会被剔除），",e.jsx("a",{target:"_blank",href:"https://github.com/songquanpeng/one-api/issues/133?notification_referrer_id=NT_kwDOAmJSYrM2NjIwMzI3NDgyOjM5OTk4MDUw#issuecomment-1571602271",children:"图片演示"}),"。"]})})}),e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"AZURE_OPENAI_ENDPOINT："})}),e.jsx(te,{label:"AZURE_OPENAI_ENDPOINT",name:"azure_base_url",placeholder:"请输入 AZURE_OPENAI_ENDPOINT，例如：https://docs-test-001.openai.azure.com",onChange:n=>{U("base_url",n)},value:C.base_url,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"默认 API 版本："})}),e.jsx(te,{label:"默认 API 版本",name:"azure_other",placeholder:"请输入默认 API 版本，例如：2023-06-01-preview，该配置可以被实际的请求查询参数所覆盖",onChange:n=>{U("other",n)},value:C.other,autoComplete:"new-password"})]}),C.type===8&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"Base URL："})}),e.jsx(te,{name:"base_url",placeholder:"请输入自定义渠道的 Base URL",onChange:n=>{U("base_url",n)},value:C.base_url,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"名称："})}),e.jsx(te,{required:!0,name:"name",placeholder:"请为渠道命名",onChange:n=>{U("name",n)},value:C.name,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"分组："})}),e.jsx(Ae,{placeholder:"请选择可以使用该渠道的分组",name:"groups",required:!0,multiple:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:n=>{U("groups",n)},value:C.groups,autoComplete:"new-password",optionList:F}),C.type===18&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"模型版本："})}),e.jsx(te,{name:"other",placeholder:"请输入星火大模型版本，注意是接口地址中的版本号，例如：v2.1",onChange:n=>{U("other",n)},value:C.other,autoComplete:"new-password"})]}),C.type===21&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"知识库 ID："})}),e.jsx(te,{label:"知识库 ID",name:"other",placeholder:"请输入知识库 ID，例如：123456",onChange:n=>{U("other",n)},value:C.other,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"模型："})}),e.jsx(Ae,{placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:n=>{U("models",n)},value:C.models,autoComplete:"new-password",optionList:D}),e.jsxs("div",{style:{lineHeight:"40px",marginBottom:"12px"},children:[e.jsxs(ce,{children:[e.jsx(v,{type:"primary",onClick:()=>{U("models",M)},children:"填入基础模型"}),e.jsx(v,{type:"secondary",onClick:()=>{U("models",W)},children:"填入所有模型"}),e.jsx(v,{type:"warning",onClick:()=>{U("models",[])},children:"清除所有模型"})]}),e.jsx(te,{addonAfter:e.jsx(v,{type:"primary",onClick:T,children:"填入"}),placeholder:"输入自定义模型名称",value:Q,onChange:n=>{X(n.trim())}})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"模型重定向："})}),e.jsx(Ru,{placeholder:`此项可选，用于修改请求体中的模型名称，为一个 JSON 字符串，键为请求中模型名称，值为要替换的模型名称，例如：
${JSON.stringify(Nu,null,2)}`,name:"model_mapping",onChange:n=>{U("model_mapping",n)},autosize:!0,value:C.model_mapping,autoComplete:"new-password"}),e.jsx(V.Text,{style:{color:"rgba(var(--semi-blue-5), 1)",userSelect:"none",cursor:"pointer"},onClick:()=>{U("model_mapping",JSON.stringify(Nu,null,2))},children:"填入模板"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"密钥："})}),y?e.jsx(Ru,{label:"密钥",name:"key",required:!0,placeholder:"请输入密钥，一行一个",onChange:n=>{U("key",n)},value:C.key,style:{minHeight:150,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password"}):e.jsx(te,{label:"密钥",name:"key",required:!0,placeholder:As(C.type),onChange:n=>{U("key",n)},value:C.key,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"组织："})}),e.jsx(te,{label:"组织，可选，不填则为默认组织",name:"openai_organization",placeholder:"请输入组织org-xxx",onChange:n=>{U("openai_organization",n)},value:C.openai_organization}),e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"默认测试模型："})}),e.jsx(te,{name:"test_model",placeholder:"不填则为模型列表第一个",onChange:n=>{U("test_model",n)},value:C.test_model}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(ce,{children:[e.jsx(Bu,{name:"auto_ban",checked:R,onChange:()=>{L(!R)}}),e.jsx(V.Text,{strong:!0,children:"是否自动禁用（仅当自动禁用开启时有效），关闭后不会自动禁用该渠道："})]})}),!l&&e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(ce,{children:[e.jsx(Bu,{checked:y,label:"批量创建",name:"batch",onChange:()=>I(!y)}),e.jsx(V.Text,{strong:!0,children:"批量创建"})]})}),C.type!==3&&C.type!==8&&C.type!==22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"代理："})}),e.jsx(te,{label:"代理",name:"base_url",placeholder:"此项可选，用于通过代理站来进行 API 调用",onChange:n=>{U("base_url",n)},value:C.base_url,autoComplete:"new-password"})]}),C.type===22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(V.Text,{strong:!0,children:"私有部署地址："})}),e.jsx(te,{name:"base_url",placeholder:"请输入私有部署地址，格式为：https://fastgpt.run/api/openapi",onChange:n=>{U("base_url",n)},value:C.base_url,autoComplete:"new-password"})]})]})})})};let He;function bs(u){var t,l;if(!He){He=new Map;for(let a=0;a<hu.length;a++)He[hu[a].value]=hu[a];He[0]={value:0,text:"未知类型",color:"grey"}}return e.jsx(S,{size:"large",color:(t=He[u])==null?void 0:t.color,children:(l=He[u])==null?void 0:l.text})}const ws=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"分组",dataIndex:"group",render:(E,f,ee)=>e.jsx("div",{children:e.jsx(ce,{spacing:2,children:E.split(",").map((ne,re)=>tt(ne))})})},{title:"类型",dataIndex:"type",render:(E,f,ee)=>e.jsx("div",{children:bs(E)})},{title:"状态",dataIndex:"status",render:(E,f,ee)=>e.jsx("div",{children:G(E)})},{title:"响应时间",dataIndex:"response_time",render:(E,f,ee)=>e.jsx("div",{children:le(E)})},{title:"已用/剩余",dataIndex:"expired_time",render:(E,f,ee)=>e.jsx("div",{children:e.jsxs(ce,{spacing:1,children:[e.jsx(Le,{content:"已用额度",children:e.jsx(S,{color:"white",type:"ghost",size:"large",children:xe(f.used_quota)})}),e.jsx(Le,{content:"剩余额度"+f.balance+"，点击更新",children:e.jsxs(S,{color:"white",type:"ghost",size:"large",onClick:()=>{pe(f)},children:["$",us(f.balance)]})})]})})},{title:"优先级",dataIndex:"priority",render:(E,f,ee)=>e.jsx("div",{children:e.jsx(yu,{style:{width:70},name:"priority",onBlur:ne=>{w(f.id,"priority",f,ne.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:f.priority,min:-999})})},{title:"权重",dataIndex:"weight",render:(E,f,ee)=>e.jsx("div",{children:e.jsx(yu,{style:{width:70},name:"weight",onBlur:ne=>{w(f.id,"weight",f,ne.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:f.weight,min:0})})},{title:"",dataIndex:"operate",render:(E,f,ee)=>e.jsxs("div",{children:[e.jsxs(Hu,{style:{marginRight:1},"aria-label":"测试操作项目组",children:[e.jsx(v,{theme:"light",onClick:()=>{z(f,"")},children:"测试"}),e.jsx(Oe,{trigger:"click",position:"bottomRight",menu:f.test_models,children:e.jsx(v,{style:{padding:"8px 4px"},type:"primary",icon:e.jsx(qu,{})})})]}),e.jsx(De,{title:"确定是否要删除此渠道？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{w(f.id,"delete",f).then(()=>{d(f.id)})},children:e.jsx(v,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),f.status===1?e.jsx(v,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{w(f.id,"disable",f)},children:"禁用"}):e.jsx(v,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{w(f.id,"enable",f)},children:"启用"}),e.jsx(v,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{T(f),O(!0)},children:"编辑"}),e.jsx(De,{title:"确定是否要复制此渠道？",content:"复制渠道的所有信息",okType:"danger",position:"left",onConfirm:async()=>{b(f.id)},children:e.jsx(v,{theme:"light",type:"primary",style:{marginRight:1},children:"复制"})})]})}],[t,l]=s.useState([]),[a,o]=s.useState(!0),[r,c]=s.useState(1),[y,I]=s.useState(!1),[R,L]=s.useState(""),[C,B]=s.useState(""),[j,h]=s.useState(""),[D,A]=s.useState(!1),[F,P]=s.useState(!1),[M,q]=s.useState(ie);s.useState(es("channel-test"));const[W,k]=s.useState(M),[Q,X]=s.useState([]),[U,O]=s.useState(!1),[g,K]=s.useState(!1),[N,T]=s.useState({id:void 0}),[n,i]=s.useState([]),d=E=>{let f=[...t];if(E!=null){let ee=f.findIndex(ne=>ne.id===E);ee>-1&&(f.splice(ee,1),l(f))}},H=E=>{for(let f=0;f<E.length;f++){E[f].key=""+E[f].id;let ee=[];E[f].models.split(",").forEach((ne,re)=>{ee.push({node:"item",name:ne,onClick:()=>{z(E[f],ne)}})}),E[f].test_models=ee}l(E),E.length>=M?k(E.length+M):k(E.length)},Y=async(E,f,ee)=>{o(!0);const ne=await _.get(`/api/channel/?p=${E}&page_size=${f}&id_sort=${ee}`);if(ne===void 0)return;const{success:re,message:Ee,data:ke}=ne.data;if(re)if(E===0)H(ke);else{let ze=[...t];ze.splice(E*f,ke.length,...ke),H(ze)}else p(Ee);o(!1)},b=async E=>{const f=t.find(ee=>String(ee.id)===String(E));if(console.log(f),f.name+="_复制",f.created_time=null,f.balance=0,f.used_quota=0,!f){p("渠道未找到，请刷新页面后重试。");return}try{const ee={...f,id:void 0},ne=await _.post("/api/channel/",ee);ne.data.success?(Z("渠道复制成功"),await J()):p(ne.data.message)}catch(ee){p("渠道复制失败: "+ee.message)}},J=async()=>{await Y(r-1,M,y)};s.useEffect(()=>{const E=localStorage.getItem("id-sort")==="true",f=parseInt(localStorage.getItem("page-size"))||ie;I(E),q(f),Y(0,f,E).then().catch(ee=>{p(ee)}),Cu().then()},[]);const w=async(E,f,ee,ne)=>{let re={id:E},Ee;switch(f){case"delete":Ee=await _.delete(`/api/channel/${E}/`);break;case"enable":re.status=1,Ee=await _.put("/api/channel/",re);break;case"disable":re.status=2,Ee=await _.put("/api/channel/",re);break;case"priority":if(ne==="")return;re.priority=parseInt(ne),Ee=await _.put("/api/channel/",re);break;case"weight":if(ne==="")return;re.weight=parseInt(ne),re.weight<0&&(re.weight=0),Ee=await _.put("/api/channel/",re);break}const{success:ke,message:ze}=Ee.data;if(ke){Z("操作成功完成！");let ou=Ee.data.data,$=[...t];f==="delete"||(ee.status=ou.status),l($)}else p(ze)},G=E=>{switch(E){case 1:return e.jsx(S,{size:"large",color:"green",children:"已启用"});case 2:return e.jsx(S,{size:"large",color:"yellow",children:"已禁用"});case 3:return e.jsx(S,{size:"large",color:"yellow",children:"自动禁用"});default:return e.jsx(S,{size:"large",color:"grey",children:"未知状态"})}},le=E=>{let f=E/1e3;return f=f.toFixed(2)+" 秒",E===0?e.jsx(S,{size:"large",color:"grey",children:"未测试"}):E<=1e3?e.jsx(S,{size:"large",color:"green",children:f}):E<=3e3?e.jsx(S,{size:"large",color:"lime",children:f}):E<=5e3?e.jsx(S,{size:"large",color:"yellow",children:f}):e.jsx(S,{size:"large",color:"red",children:f})},x=async(E,f,ee)=>{if(E===""&&f===""&&ee===""){await Y(0,M,y),c(1);return}A(!0);const ne=await _.get(`/api/channel/search?keyword=${E}&group=${f}&model=${ee}`),{success:re,message:Ee,data:ke}=ne.data;re?(l(ke),c(1)):p(Ee),A(!1)},z=async(E,f)=>{const ee=await _.get(`/api/channel/test/${E.id}?model=${f}`),{success:ne,message:re,time:Ee}=ee.data;ne?(E.response_time=Ee*1e3,E.test_time=Date.now()/1e3,ye(`通道 ${E.name} 测试成功，耗时 ${Ee.toFixed(2)} 秒。`)):p(re)},se=async()=>{const E=await _.get("/api/channel/test"),{success:f,message:ee}=E.data;f?ye("已成功开始测试所有通道，请刷新页面查看结果。"):p(ee)},me=async()=>{const E=await _.delete("/api/channel/disabled"),{success:f,message:ee,data:ne}=E.data;f?(Z(`已删除所有禁用渠道，共计 ${ne} 个`),await J()):p(ee)},pe=async E=>{const f=await _.get(`/api/channel/update_balance/${E.id}/`),{success:ee,message:ne,balance:re}=f.data;ee?(E.balance=re,E.balance_updated_time=Date.now()/1e3,ye(`通道 ${E.name} 余额更新成功！`)):p(ne)},Ce=async()=>{P(!0);const E=await _.get("/api/channel/update_balance"),{success:f,message:ee}=E.data;f?ye("已更新完毕所有已启用通道余额！"):p(ee),P(!1)},Ve=async()=>{if(n.length===0){p("请先选择要删除的通道！");return}o(!0);let E=[];n.forEach(Ee=>{E.push(Ee.id)});const f=await _.post("/api/channel/batch",{ids:E}),{success:ee,message:ne,data:re}=f.data;ee?(Z(`已删除 ${re} 个通道！`),await J()):p(ne),o(!1)},Ye=async()=>{const E=await _.post("/api/channel/fix"),{success:f,message:ee,data:ne}=E.data;f?(Z(`已修复 ${ne} 个通道！`),await J()):p(ee)};let Ze=t.slice((r-1)*M,r*M);const ve=E=>{c(E),E===Math.ceil(t.length/M)+1&&Y(E-1,M,y).then(f=>{})},Ke=async E=>{localStorage.setItem("page-size",E+""),q(E),c(1),Y(0,E,y).then().catch(f=>{p(f)})},Cu=async()=>{try{let E=await _.get("/api/group/");if(E===void 0)return;X(E.data.data.map(f=>({label:f,value:f})))}catch(E){p(E.message)}},iu=()=>{O(!1)},ru=(E,f)=>E.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(Su,{refresh:J,visible:U,handleClose:iu,editingChannel:N}),e.jsx(ue,{onSubmit:()=>{x(R,C,j)},labelPosition:"left",children:e.jsx("div",{style:{display:"flex"},children:e.jsxs(ce,{children:[e.jsx(ue.Input,{field:"search_keyword",label:"搜索渠道关键词",placeholder:"ID，名称和密钥 ...",value:R,loading:D,onChange:E=>{L(E.trim())}}),e.jsx(ue.Input,{field:"search_model",label:"模型",placeholder:"模型关键字",value:j,loading:D,onChange:E=>{h(E.trim())}}),e.jsx(ue.Select,{field:"group",label:"分组",optionList:Q,onChange:E=>{B(E),x(R,E,j)}}),e.jsx(v,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",style:{marginRight:8},children:"查询"})]})})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsx(ce,{children:e.jsxs(ce,{children:[e.jsx(V.Text,{strong:!0,children:"使用ID排序"}),e.jsx(Du,{checked:y,label:"使用ID排序",uncheckedText:"关","aria-label":"是否用ID排序",onChange:E=>{localStorage.setItem("id-sort",E+""),I(E),Y(0,M,E).then().catch(f=>{p(f)})}})]})})}),e.jsx(Je,{className:"channel-table",style:{marginTop:15},columns:u,dataSource:Ze,pagination:{currentPage:r,pageSize:M,total:W,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,formatPageText:E=>"",onPageSizeChange:E=>{Ke(E).then()},onPageChange:ve},loading:a,onRow:ru,rowSelection:g?{onChange:(E,f)=>{i(f)}}:null}),e.jsx("div",{style:{display:Be()?"":"flex",marginTop:Be()?0:-45,zIndex:999,position:"relative",pointerEvents:"none"},children:e.jsxs(ce,{style:{pointerEvents:"auto",marginTop:Be()?0:45},children:[e.jsx(v,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{T({id:void 0}),O(!0)},children:"添加渠道"}),e.jsx(De,{title:"确定？",okType:"warning",onConfirm:se,position:(Be(),"top"),children:e.jsx(v,{theme:"light",type:"warning",style:{marginRight:8},children:"测试所有通道"})}),e.jsx(De,{title:"确定？",okType:"secondary",onConfirm:Ce,children:e.jsx(v,{theme:"light",type:"secondary",style:{marginRight:8},children:"更新所有已启用通道余额"})}),e.jsx(De,{title:"确定是否要删除禁用通道？",content:"此修改将不可逆",okType:"danger",onConfirm:me,children:e.jsx(v,{theme:"light",type:"danger",style:{marginRight:8},children:"删除禁用通道"})}),e.jsx(v,{theme:"light",type:"primary",style:{marginRight:8},onClick:J,children:"刷新"})]})}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(ce,{children:[e.jsx(V.Text,{strong:!0,children:"开启批量删除"}),e.jsx(Du,{label:"开启批量删除",uncheckedText:"关","aria-label":"是否开启批量删除",onChange:E=>{K(E)}}),e.jsx(De,{title:"确定是否要删除所选通道？",content:"此修改将不可逆",okType:"danger",onConfirm:Ve,disabled:!g,position:"top",children:e.jsx(v,{disabled:!g,theme:"light",type:"danger",style:{marginRight:8},children:"删除所选通道"})}),e.jsx(De,{title:"确定是否要修复数据库一致性？",content:"进行该操作时，可能导致渠道访问错误，请仅在数据库出现问题时使用",okType:"warning",onConfirm:Ye,position:"top",children:e.jsx(v,{theme:"light",type:"secondary",style:{marginRight:8},children:"修复数据库一致性"})})]})})]})},Ss=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"管理渠道"})}),e.jsx(ae.Content,{children:e.jsx(ws,{})})]})}),vs=u=>{const[t,l]=s.useState(!1),[a,o]=s.useState(t),r={name:"",remain_quota:t?0:5e5,expired_time:-1,unlimited_quota:!1,model_limits_enabled:!1,model_limits:[]},[c,y]=s.useState(r),{name:I,remain_quota:R,expired_time:L,unlimited_quota:C,model_limits_enabled:B,model_limits:j}=c,[h,D]=s.useState({});Se();const A=(g,K)=>{y(N=>({...N,[g]:K}))},F=()=>{u.handleClose()},P=(g,K,N,T)=>{let i=new Date().getTime()/1e3,d=g*30*24*60*60;d+=K*24*60*60,d+=N*60*60,d+=T*60,d!==0?(i+=d,y({...c,expired_time:we(i)})):y({...c,expired_time:-1})},M=()=>{y({...c,unlimited_quota:!C})},q=async()=>{let g=await _.get("/api/user/models");const{success:K,message:N,data:T}=g.data;if(K){let n=T.map(i=>({label:i,value:i}));D(n)}else p(N)},W=async()=>{o(!0);let g=await _.get(`/api/token/${u.editingToken.id}`);const{success:K,message:N,data:T}=g.data;K?(T.expired_time!==-1&&(T.expired_time=we(T.expired_time)),T.model_limits!==""?T.model_limits=T.model_limits.split(","):T.model_limits=[],y(T)):p(N),o(!1)};s.useEffect(()=>{l(u.editingToken.id!==void 0)},[u.editingToken.id]),s.useEffect(()=>{t?W().then(()=>{}):y(r),q()},[t]);const[k,Q]=s.useState(1),X=g=>{const K=parseInt(g,10);!isNaN(K)&&K>0&&Q(K)},U=()=>{const g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let K="";for(let N=0;N<6;N++)K+=g.charAt(Math.floor(Math.random()*g.length));return K},O=async()=>{if(o(!0),t){let g={...c};if(g.remain_quota=parseInt(g.remain_quota),g.expired_time!==-1){let n=Date.parse(g.expired_time);if(isNaN(n)){p("过期时间格式错误！"),o(!1);return}g.expired_time=Math.ceil(n/1e3)}g.model_limits=g.model_limits.join(",");let K=await _.put("/api/token/",{...g,id:parseInt(u.editingToken.id)});const{success:N,message:T}=K.data;N?(Z("令牌更新成功！"),u.refresh(),u.handleClose()):p(T)}else{let g=0;for(let K=0;K<k;K++){let N={...c};if(K!==0&&(N.name=`${c.name}-${U()}`),N.remain_quota=parseInt(N.remain_quota),N.expired_time!==-1){let d=Date.parse(N.expired_time);if(isNaN(d)){p("过期时间格式错误！"),o(!1);break}N.expired_time=Math.ceil(d/1e3)}N.model_limits=N.model_limits.join(",");let T=await _.post("/api/token/",N);const{success:n,message:i}=T.data;if(n)g++;else{p(i);break}}g>0&&(Z(`${g}个令牌创建成功，请在列表页面点击复制获取令牌！`),u.refresh(),u.handleClose())}o(!1),y(r),Q(1)};return e.jsx(e.Fragment,{children:e.jsx(nu,{placement:t?"right":"left",title:e.jsx(Ge,{level:3,children:t?"更新令牌信息":"创建新的令牌"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(ce,{children:[e.jsx(v,{theme:"solid",size:"large",onClick:O,children:"提交"}),e.jsx(v,{theme:"solid",size:"large",type:"tertiary",onClick:F,children:"取消"})]})}),closeIcon:null,onCancel:()=>F(),width:Be()?"100%":600,children:e.jsxs(Ue,{spinning:a,children:[e.jsx(te,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:g=>A("name",g),value:I,autoComplete:"new-password",required:!t}),e.jsx(ge,{}),e.jsx(yt,{label:"过期时间",name:"expired_time",placeholder:"请选择过期时间",onChange:g=>A("expired_time",g),value:L,autoComplete:"new-password",type:"dateTime"}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(ce,{children:[e.jsx(v,{type:"tertiary",onClick:()=>{P(0,0,0,0)},children:"永不过期"}),e.jsx(v,{type:"tertiary",onClick:()=>{P(0,0,1,0)},children:"一小时"}),e.jsx(v,{type:"tertiary",onClick:()=>{P(1,0,0,0)},children:"一个月"}),e.jsx(v,{type:"tertiary",onClick:()=>{P(0,1,0,0)},children:"一天"})]})}),e.jsx(ge,{}),e.jsx(au,{type:"warning",description:"注意，令牌的额度仅用于限制令牌本身的最大额度使用量，实际的使用受到账户的剩余额度限制。"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:`额度${uu(R)}`})}),e.jsx(Au,{style:{marginTop:8},name:"remain_quota",placeholder:"请输入额度",onChange:g=>A("remain_quota",g),value:R,autoComplete:"new-password",type:"number",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}],disabled:C}),!t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:"新建数量"})}),e.jsx(Au,{style:{marginTop:8},label:"数量",placeholder:"请选择或输入创建令牌的数量",onChange:g=>X(g),onSelect:g=>X(g),value:k.toString(),autoComplete:"off",type:"number",data:[{value:10,label:"10个"},{value:20,label:"20个"},{value:30,label:"30个"},{value:100,label:"100个"}],disabled:C})]}),e.jsx("div",{children:e.jsx(v,{style:{marginTop:8},type:"warning",onClick:()=>{M()},children:C?"取消无限额度":"设为无限额度"})}),e.jsx(ge,{}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(ce,{children:[e.jsx(Bu,{name:"model_limits_enabled",checked:B,onChange:g=>A("model_limits_enabled",g.target.checked)}),e.jsx(V.Text,{children:"启用模型限制（非必要，不建议启用）"})]})}),e.jsx(Ae,{style:{marginTop:8},placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:g=>{A("model_limits",g)},value:c.model_limits,autoComplete:"new-password",optionList:h,disabled:!B})]})})})};function Uu(u){return e.jsx(e.Fragment,{children:we(u)})}function ks(u,t=!1){switch(u){case 1:return t?e.jsx(S,{color:"green",size:"large",children:"已启用：限制模型"}):e.jsx(S,{color:"green",size:"large",children:"已启用"});case 2:return e.jsxs(S,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs(S,{color:"yellow",size:"large",children:[" ","已过期"," "]});case 4:return e.jsxs(S,{color:"grey",size:"large",children:[" ","已耗尽"," "]});default:return e.jsxs(S,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const _s=()=>{const u=[{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(w,G,le)=>e.jsx("div",{children:ks(w,G.model_limits_enabled)})},{title:"已用额度",dataIndex:"used_quota",render:(w,G,le)=>e.jsx("div",{children:xe(parseInt(w))})},{title:"剩余额度",dataIndex:"remain_quota",render:(w,G,le)=>e.jsx("div",{children:G.unlimited_quota?e.jsx(S,{size:"large",color:"white",children:"无限制"}):e.jsx(S,{size:"large",color:"light-blue",children:xe(parseInt(w))})})},{title:"创建时间",dataIndex:"created_time",render:(w,G,le)=>e.jsx("div",{children:Uu(w)})},{title:"过期时间",dataIndex:"expired_time",render:(w,G,le)=>e.jsx("div",{children:G.expired_time===-1?"永不过期":Uu(w)})},{title:"",dataIndex:"operate",render:(w,G,le)=>e.jsxs("div",{children:[e.jsx(Qu,{content:"sk-"+G.key,style:{padding:20},position:"top",children:e.jsx(v,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(v,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async x=>{await K("sk-"+G.key)},children:"复制"}),e.jsxs(Hu,{style:{marginRight:1},"aria-label":"项目操作按钮组",children:[e.jsx(v,{theme:"light",style:{color:"rgba(var(--semi-teal-7), 1)"},onClick:()=>{N("next",G.key)},children:"聊天"}),e.jsx(Oe,{trigger:"click",position:"bottomRight",menu:[{node:"item",key:"next",disabled:!localStorage.getItem("chat_link"),name:"ChatGPT Next Web",onClick:()=>{N("next",G.key)}},{node:"item",key:"next-mj",disabled:!localStorage.getItem("chat_link2"),name:"ChatGPT Web & Midjourney",onClick:()=>{N("next-mj",G.key)}},{node:"item",key:"ama",name:"AMA 问天（BotGem）",onClick:()=>{N("ama",G.key)}},{node:"item",key:"opencat",name:"OpenCat",onClick:()=>{N("opencat",G.key)}}],children:e.jsx(v,{style:{padding:"8px 4px",color:"rgba(var(--semi-teal-7), 1)"},type:"primary",icon:e.jsx(qu,{})})})]}),e.jsx(De,{title:"确定是否要删除此令牌？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{n(G.id,"delete",G).then(()=>{T(G.key)})},children:e.jsx(v,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),G.status===1?e.jsx(v,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{n(G.id,"disable",G)},children:"禁用"}):e.jsx(v,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{n(G.id,"enable",G)},children:"启用"}),e.jsx(v,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{k(G),o(!0)},children:"编辑"})]})}],[t,l]=s.useState(ie),[a,o]=s.useState(!1),[r,c]=s.useState([]),[y,I]=s.useState([]),[R,L]=s.useState(t),[C,B]=s.useState(!0),[j,h]=s.useState(1),[D,A]=s.useState(""),[F,P]=s.useState(""),[M,q]=s.useState(!1);s.useState(!1),s.useState(0);const[W,k]=s.useState({id:void 0}),Q=()=>{o(!1),setTimeout(()=>{k({id:void 0})},500)},X=w=>{c(w),w.length>=t?L(w.length+t):L(w.length)};let U=r.slice((j-1)*t,j*t);const O=async w=>{B(!0);const G=await _.get(`/api/token/?p=${w}&size=${t}`),{success:le,message:x,data:z}=G.data;if(le)if(w===0)X(z);else{let se=[...r];se.splice(w*t,z.length,...z),X(se)}else p(x);B(!1)},g=async()=>{await O(j-1)},K=async w=>{await Re(w)?Z("已复制到剪贴板！"):je.error({title:"无法复制到剪贴板，请手动复制",content:w,size:"large"})},N=async(w,G)=>{let le=localStorage.getItem("status"),x="";le&&(le=JSON.parse(le),x=le.server_address),x===""&&(x=window.location.origin);let z=encodeURIComponent(x);const se=localStorage.getItem("chat_link"),me=localStorage.getItem("chat_link2");let pe;se&&(pe=se+`/#/?settings={"key":"sk-${G}","url":"${x}"}`);let Ce;switch(w){case"ama":Ce=`ama://set-api-key?server=${z}&key=sk-${G}`;break;case"opencat":Ce=`opencat://team/join?domain=${z}&token=sk-${G}`;break;case"next-mj":Ce=me+`/#/?settings={"key":"sk-${G}","url":"${x}"}`;break;default:if(!se){p("管理员未设置聊天链接");return}Ce=pe}window.open(Ce,"_blank")};s.useEffect(()=>{O(0).then().catch(w=>{p(w)})},[t]);const T=w=>{let G=[...r];if(w!=null){let le=G.findIndex(x=>x.key===w);le>-1&&(G.splice(le,1),X(G))}},n=async(w,G,le)=>{B(!0);let x={id:w},z;switch(G){case"delete":z=await _.delete(`/api/token/${w}/`);break;case"enable":x.status=1,z=await _.put("/api/token/?status_only=true",x);break;case"disable":x.status=2,z=await _.put("/api/token/?status_only=true",x);break}const{success:se,message:me}=z.data;if(se){Z("操作成功完成！");let pe=z.data.data,Ce=[...r];G==="delete"||(le.status=pe.status),X(Ce)}else p(me);B(!1)},i=async()=>{if(D===""&&F===""){await O(0),h(1);return}q(!0);const w=await _.get(`/api/token/search?keyword=${D}&token=${F}`),{success:G,message:le,data:x}=w.data;G?(X(x),h(1)):p(le),q(!1)},d=async w=>{A(w.trim())},H=async w=>{P(w.trim())},Y=w=>{h(w),w===Math.ceil(r.length/t)+1&&O(w-1).then(G=>{})},b={onSelect:(w,G)=>{},onSelectAll:(w,G)=>{},onChange:(w,G)=>{I(G)}},J=(w,G)=>w.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(vs,{refresh:g,editingToken:W,visiable:a,handleClose:Q}),e.jsxs(ue,{layout:"horizontal",style:{marginTop:10},labelPosition:"left",children:[e.jsx(ue.Input,{field:"keyword",label:"搜索关键字",placeholder:"令牌名称",value:D,loading:M,onChange:d}),e.jsx(ue.Input,{field:"token",label:"Key",placeholder:"密钥",value:F,loading:M,onChange:H}),e.jsx(v,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:i,style:{marginRight:8},children:"查询"})]}),e.jsx(Je,{style:{marginTop:20},columns:u,dataSource:U,pagination:{currentPage:j,pageSize:t,total:R,showSizeChanger:!0,pageSizeOptions:[10,20,50,100],formatPageText:w=>`第 ${w.currentStart} - ${w.currentEnd} 条，共 ${r.length} 条`,onPageSizeChange:w=>{l(w),h(1)},onPageChange:Y},loading:C,rowSelection:b,onRow:J}),e.jsx(v,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{k({id:void 0}),o(!0)},children:"添加令牌"}),e.jsx(v,{label:"复制所选令牌",type:"warning",onClick:async()=>{if(y.length===0){p("请至少选择一个令牌！");return}let w="";for(let G=0;G<y.length;G++)w+=y[G].name+"    sk-"+y[G].key+`
`;await K(w)},children:"复制所选令牌到剪贴板"})]})},Ts=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"我的令牌"})}),e.jsx(ae.Content,{children:e.jsx(_s,{})})]})}),Is=u=>{const t=u.editingRedemption.id!==void 0,[l,a]=s.useState(t);Ft(),Se();const o={name:"",quota:1e5,count:1},[r,c]=s.useState(o),{name:y,quota:I,count:R}=r,L=()=>{u.handleClose()},C=(h,D)=>{c(A=>({...A,[h]:D}))},B=async()=>{a(!0);let h=await _.get(`/api/redemption/${u.editingRedemption.id}`);const{success:D,message:A,data:F}=h.data;D?c(F):p(A),a(!1)};s.useEffect(()=>{t?B().then(()=>{}):c(o)},[u.editingRedemption.id]);const j=async()=>{if(!t&&r.name==="")return;a(!0);let h=r;h.count=parseInt(h.count),h.quota=parseInt(h.quota);let D;t?D=await _.put("/api/redemption/",{...h,id:parseInt(u.editingRedemption.id)}):D=await _.post("/api/redemption/",{...h});const{success:A,message:F,data:P}=D.data;if(A?t?(Z("兑换码更新成功！"),u.refresh(),u.handleClose()):(Z("兑换码创建成功！"),c(o),u.refresh(),u.handleClose()):p(F),!t&&P){let M="";for(let q=0;q<P.length;q++)M+=P[q]+`
`;je.confirm({title:"兑换码创建成功",content:e.jsxs("div",{children:[e.jsx("p",{children:"兑换码创建成功，是否下载兑换码？"}),e.jsx("p",{children:"兑换码将以文本文件的形式下载，文件名为兑换码的名称。"})]}),onOk:()=>{Xt(M,`${r.name}.txt`)}})}a(!1)};return e.jsx(e.Fragment,{children:e.jsx(nu,{placement:t?"right":"left",title:e.jsx(Ge,{level:3,children:t?"更新兑换码信息":"创建新的兑换码"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(ce,{children:[e.jsx(v,{theme:"solid",size:"large",onClick:j,children:"提交"}),e.jsx(v,{theme:"solid",size:"large",type:"tertiary",onClick:L,children:"取消"})]})}),closeIcon:null,onCancel:()=>L(),width:Be()?"100%":600,children:e.jsxs(Ue,{spinning:l,children:[e.jsx(te,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:h=>C("name",h),value:y,autoComplete:"new-password",required:!t}),e.jsx(ge,{}),e.jsx("div",{style:{marginTop:20},children:e.jsx(V.Text,{children:`额度${uu(I)}`})}),e.jsx(Au,{style:{marginTop:8},name:"quota",placeholder:"请输入额度",onChange:h=>C("quota",h),value:I,autoComplete:"new-password",type:"number",position:"bottom",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}]}),!t&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{}),e.jsx(V.Text,{children:"生成数量"}),e.jsx(te,{style:{marginTop:8},label:"生成数量",name:"count",placeholder:"请输入生成数量",onChange:h=>C("count",h),value:R,autoComplete:"new-password",type:"number"})]})]})})})};function Ps(u){return e.jsx(e.Fragment,{children:we(u)})}function Rs(u){switch(u){case 1:return e.jsx(S,{color:"green",size:"large",children:"未使用"});case 2:return e.jsxs(S,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs(S,{color:"grey",size:"large",children:[" ","已使用"," "]});default:return e.jsxs(S,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const Ms=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(i,d,H)=>e.jsx("div",{children:Rs(i)})},{title:"额度",dataIndex:"quota",render:(i,d,H)=>e.jsx("div",{children:xe(parseInt(i))})},{title:"创建时间",dataIndex:"created_time",render:(i,d,H)=>e.jsx("div",{children:Ps(i)})},{title:"兑换人ID",dataIndex:"used_user_id",render:(i,d,H)=>e.jsx("div",{children:i===0?"无":i})},{title:"",dataIndex:"operate",render:(i,d,H)=>e.jsxs("div",{children:[e.jsx(Qu,{content:d.key,style:{padding:20},position:"top",children:e.jsx(v,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(v,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async Y=>{await Q(d.key)},children:"复制"}),e.jsx(De,{title:"确定是否要删除此兑换码？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{U(d.id,"delete",d).then(()=>{k(d.key)})},children:e.jsx(v,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),d.status===1?e.jsx(v,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{U(d.id,"disable",d)},children:"禁用"}):e.jsx(v,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{U(d.id,"enable",d)},disabled:d.status===3,children:"启用"}),e.jsx(v,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{A(d),P(!0)},disabled:d.status!==1,children:"编辑"})]})}],[t,l]=s.useState([]),[a,o]=s.useState(!0),[r,c]=s.useState(1),[y,I]=s.useState(""),[R,L]=s.useState(!1),[C,B]=s.useState(ie),[j,h]=s.useState([]),[D,A]=s.useState({id:void 0}),[F,P]=s.useState(!1),M=()=>{P(!1)},q=i=>{l(i),i.length>=r*ie?B(i.length+1):B(i.length)},W=async i=>{const d=await _.get(`/api/redemption/?p=${i}`),{success:H,message:Y,data:b}=d.data;if(H)if(i===0)q(b);else{let J=t;J.push(...b),q(J)}else p(Y);o(!1)},k=i=>{let d=[...t];if(i!=null){let H=d.findIndex(Y=>Y.key===i);H>-1&&(d.splice(H,1),l(d))}},Q=async i=>{await Re(i)?Z("已复制到剪贴板！"):je.error({title:"无法复制到剪贴板，请手动复制",content:i})};s.useEffect(()=>{W(0).then().catch(i=>{p(i)})},[]);const X=async()=>{await W(r-1)},U=async(i,d,H)=>{let Y={id:i},b;switch(d){case"delete":b=await _.delete(`/api/redemption/${i}/`);break;case"enable":Y.status=1,b=await _.put("/api/redemption/?status_only=true",Y);break;case"disable":Y.status=2,b=await _.put("/api/redemption/?status_only=true",Y);break}const{success:J,message:w}=b.data;if(J){Z("操作成功完成！");let G=b.data.data,le=[...t];d==="delete"||(H.status=G.status),l(le)}else p(w)},O=async()=>{if(y===""){await W(0),c(1);return}L(!0);const i=await _.get(`/api/redemption/search?keyword=${y}`),{success:d,message:H,data:Y}=i.data;d?(l(Y),c(1)):p(H),L(!1)},g=async i=>{I(i.trim())},K=i=>{c(i),i===Math.ceil(t.length/ie)+1&&W(i-1).then(d=>{})};let N=t.slice((r-1)*ie,r*ie);const T={onSelect:(i,d)=>{},onSelectAll:(i,d)=>{},onChange:(i,d)=>{h(d)}},n=(i,d)=>i.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(Is,{refresh:X,editingRedemption:D,visiable:F,handleClose:M}),e.jsx(ue,{onSubmit:O,children:e.jsx(ue.Input,{label:"搜索关键字",field:"keyword",icon:"search",iconPosition:"left",placeholder:"关键字(id或者名称)",value:y,loading:R,onChange:g})}),e.jsx(Je,{style:{marginTop:20},columns:u,dataSource:N,pagination:{currentPage:r,pageSize:ie,total:C,formatPageText:i=>`第 ${i.currentStart} - ${i.currentEnd} 条，共 ${t.length} 条`,onPageChange:K},loading:a,rowSelection:T,onRow:n}),e.jsx(v,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{A({id:void 0}),P(!0)},children:"添加兑换码"}),e.jsx(v,{label:"复制所选兑换码",type:"warning",onClick:async()=>{if(j.length===0){p("请至少选择一个兑换码！");return}let i="";for(let d=0;d<j.length;d++)i+=j[d].name+"    "+j[d].key+`
`;await Q(i)},children:"复制所选兑换码到剪贴板"})]})},Ls=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"管理兑换码"})}),e.jsx(ae.Content,{children:e.jsx(Ms,{})})]})}),Os=()=>{const[u,t]=s.useState(""),[l,a]=s.useState(""),[o,r]=s.useState(0);s.useState(1);const[c,y]=s.useState(0),[I,R]=s.useState(1),[L,C]=s.useState(""),[B,j]=s.useState(!1),[h,D]=s.useState(0),[A,F]=s.useState(!1),[P,M]=s.useState(!1),[q,W]=s.useState(""),k=async()=>{if(u===""){ye("请输入兑换码！");return}F(!0);try{const T=await _.post("/api/user/topup",{key:u}),{success:n,message:i,data:d}=T.data;n?(Z("兑换成功！"),je.success({title:"兑换成功！",content:"成功兑换额度："+xe(d),centered:!0}),D(H=>H+d),t("")):p(i)}catch{p("请求失败")}finally{F(!1)}},Q=()=>{if(!L){p("超级管理员未设置充值链接！");return}window.open(L,"_blank")},X=async T=>{if(!B){p("管理员未开启在线充值！");return}if(await K(),o<I){p("充值数量不能小于"+I);return}W(T),M(!0)},U=async()=>{if(c===0&&await K(),o<I){p("充值数量不能小于"+I);return}M(!1);try{const T=await _.post("/api/user/pay",{amount:parseInt(o),top_up_code:l,payment_method:q});if(T!==void 0){const{message:n,data:i}=T.data;if(n==="success"){let d=i,H=T.data.url,Y=document.createElement("form");Y.action=H,Y.method="POST",navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<1||(Y.target="_blank");for(let J in d){let w=document.createElement("input");w.type="hidden",w.name=J,w.value=d[J],Y.appendChild(w)}document.body.appendChild(Y),Y.submit(),document.body.removeChild(Y)}else p(i)}else p(T)}catch(T){console.log(T)}finally{}},O=async()=>{let T=await _.get("/api/user/self");const{success:n,message:i,data:d}=T.data;n?D(d.quota):p(i)};s.useEffect(()=>{let T=localStorage.getItem("status");T&&(T=JSON.parse(T),T.top_up_link&&C(T.top_up_link),T.min_topup&&R(T.min_topup),T.enable_online_topup&&j(T.enable_online_topup)),O().then()},[]);const g=()=>c+"元",K=async T=>{T===void 0&&(T=o);try{const n=await _.post("/api/user/amount",{amount:parseFloat(T),top_up_code:l});if(n!==void 0){const{message:i,data:d}=n.data;i==="success"?y(parseFloat(d)):(y(0),_e.error({content:"错误："+d,id:"getAmount"}))}else p(n)}catch(n){console.log(n)}finally{}},N=()=>{M(!1)};return e.jsx("div",{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"我的钱包"})}),e.jsxs(ae.Content,{children:[e.jsxs(je,{title:"确定要充值吗",visible:P,onOk:U,onCancel:N,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("p",{children:["充值数量：",o]}),e.jsxs("p",{children:["实付金额：",g()]}),e.jsx("p",{children:"是否确认充值？"})]}),e.jsx("div",{style:{marginTop:20,display:"flex",justifyContent:"center"},children:e.jsxs(qe,{style:{width:"500px",padding:"20px"},children:[e.jsxs(Ge,{level:3,style:{textAlign:"center"},children:["余额 ",xe(h)]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Fu,{children:"兑换余额"}),e.jsxs(ue,{children:[e.jsx(ue.Input,{field:"redemptionCode",label:"兑换码",placeholder:"兑换码",name:"redemptionCode",value:u,onChange:T=>{t(T)}}),e.jsxs(ce,{children:[L?e.jsx(v,{type:"primary",theme:"solid",onClick:Q,children:"获取兑换码"}):null,e.jsx(v,{type:"warning",theme:"solid",onClick:k,disabled:A,children:A?"兑换中...":"兑换"})]})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Fu,{children:"在线充值"}),e.jsxs(ue,{children:[e.jsx(ue.Input,{disabled:!B,field:"redemptionCount",label:"实付金额："+g(),placeholder:"充值数量，最低 "+ss(I),name:"redemptionCount",type:"number",value:o,onChange:async T=>{T<1&&(T=1),r(T),await K(T)}}),e.jsxs(ce,{children:[e.jsx(v,{type:"primary",theme:"solid",onClick:async()=>{X("zfb")},children:"支付宝"}),e.jsx(v,{style:{backgroundColor:"rgba(var(--semi-green-5), 1)"},type:"primary",theme:"solid",onClick:async()=>{X("wx")},children:"微信"})]})]})]})]})})]})]})})},{Header:zs}=ae,Gu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function $s(u){switch(u){case 1:return e.jsxs(S,{color:"cyan",size:"large",children:[" ","充值"," "]});case 2:return e.jsxs(S,{color:"lime",size:"large",children:[" ","消费"," "]});case 3:return e.jsxs(S,{color:"orange",size:"large",children:[" ","管理"," "]});case 4:return e.jsxs(S,{color:"purple",size:"large",children:[" ","系统"," "]});default:return e.jsxs(S,{color:"black",size:"large",children:[" ","未知"," "]})}}function Ns(u){return u?e.jsx(S,{color:"blue",size:"large",children:"流"}):e.jsx(S,{color:"purple",size:"large",children:"非流"})}function Us(u){const t=parseInt(u);return t<101?e.jsxs(S,{color:"green",size:"large",children:[" ",t," s"," "]}):t<300?e.jsxs(S,{color:"orange",size:"large",children:[" ",t," s"," "]}):e.jsxs(S,{color:"red",size:"large",children:[" ",t," s"," "]})}const Gs=()=>{const u=[{title:"时间",dataIndex:"timestamp2string"},{title:"渠道",dataIndex:"channel",className:be()?"tableShow":"tableHiddle",render:(x,z,se)=>F?z.type===0||z.type===2?e.jsx("div",{children:e.jsxs(S,{color:Gu[parseInt(x)%Gu.length],size:"large",children:[" ",x," "]})}):e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{})},{title:"用户",dataIndex:"username",className:be()?"tableShow":"tableHiddle",render:(x,z,se)=>F?e.jsxs("div",{children:[e.jsx(ku,{size:"small",color:tu(x),style:{marginRight:4},onClick:()=>d(z.user_id),children:typeof x=="string"&&x.slice(0,1)}),x]}):e.jsx(e.Fragment,{})},{title:"令牌",dataIndex:"token_name",render:(x,z,se)=>z.type===0||z.type===2?e.jsx("div",{children:e.jsxs(S,{color:"grey",size:"large",onClick:()=>{le(x)},children:[" ",x," "]})}):e.jsx(e.Fragment,{})},{title:"类型",dataIndex:"type",render:(x,z,se)=>e.jsx("div",{children:$s(x)})},{title:"模型",dataIndex:"model_name",render:(x,z,se)=>z.type===0||z.type===2?e.jsx("div",{children:e.jsxs(S,{color:tu(x),size:"large",onClick:()=>{le(x)},children:[" ",x," "]})}):e.jsx(e.Fragment,{})},{title:"用时",dataIndex:"use_time",render:(x,z,se)=>e.jsx("div",{children:e.jsxs(ce,{children:[Us(x),Ns(z.is_stream)]})})},{title:"提示",dataIndex:"prompt_tokens",render:(x,z,se)=>z.type===0||z.type===2?e.jsx("div",{children:e.jsxs("span",{children:[" ",x," "]})}):e.jsx(e.Fragment,{})},{title:"补全",dataIndex:"completion_tokens",render:(x,z,se)=>parseInt(x)>0&&(z.type===0||z.type===2)?e.jsx("div",{children:e.jsxs("span",{children:[" ",x," "]})}):e.jsx(e.Fragment,{})},{title:"花费",dataIndex:"quota",render:(x,z,se)=>z.type===0||z.type===2?e.jsx("div",{children:xe(x,6)}):e.jsx(e.Fragment,{})},{title:"详情",dataIndex:"content",render:(x,z,se)=>e.jsx(Bt,{ellipsis:{rows:2,showTooltip:{type:"popover",opts:{style:{width:240}}}},style:{maxWidth:240},children:x})}],[t,l]=s.useState([]),[a,o]=s.useState(!1),[r,c]=s.useState(!1),[y,I]=s.useState(!1),[R,L]=s.useState(1),[C,B]=s.useState(ie),[j,h]=s.useState(ie);s.useState(""),s.useState(!1);const[D,A]=s.useState(0),F=be();let P=new Date;const[M,q]=s.useState({username:"",token_name:"",model_name:"",start_timestamp:we(P.getTime()/1e3-86400),end_timestamp:we(P.getTime()/1e3+3600),channel:""}),{username:W,token_name:k,model_name:Q,start_timestamp:X,end_timestamp:U,channel:O}=M,[g,K]=s.useState({quota:0,token:0}),N=(x,z)=>{q(se=>({...se,[z]:x}))},T=async()=>{let x=Date.parse(X)/1e3,z=Date.parse(U)/1e3,se=await _.get(`/api/log/self/stat?type=${D}&token_name=${k}&model_name=${Q}&start_timestamp=${x}&end_timestamp=${z}`);const{success:me,message:pe,data:Ce}=se.data;me?K(Ce):p(pe)},n=async()=>{let x=Date.parse(X)/1e3,z=Date.parse(U)/1e3,se=await _.get(`/api/log/stat?type=${D}&username=${W}&token_name=${k}&model_name=${Q}&start_timestamp=${x}&end_timestamp=${z}&channel=${O}`);const{success:me,message:pe,data:Ce}=se.data;me?K(Ce):p(pe)},i=async()=>{I(!0),F?await n():await T(),o(!0),I(!1)},d=async x=>{if(!F)return;const z=await _.get(`/api/user/${x}`),{success:se,message:me,data:pe}=z.data;se?je.info({title:"用户信息",content:e.jsxs("div",{style:{padding:12},children:[e.jsxs("p",{children:["用户名: ",pe.username]}),e.jsxs("p",{children:["余额: ",xe(pe.quota)]}),e.jsxs("p",{children:["已用额度：",xe(pe.used_quota)]}),e.jsxs("p",{children:["请求次数：",pu(pe.request_count)]})]}),centered:!0}):p(me)},H=x=>{for(let z=0;z<x.length;z++)x[z].timestamp2string=we(x[z].created_at),x[z].key=""+x[z].id;l(x),B(x.length+ie)},Y=async(x,z,se=0)=>{c(!0);let me="",pe=Date.parse(X)/1e3,Ce=Date.parse(U)/1e3;F?me=`/api/log/?p=${x}&page_size=${z}&type=${se}&username=${W}&token_name=${k}&model_name=${Q}&start_timestamp=${pe}&end_timestamp=${Ce}&channel=${O}`:me=`/api/log/self/?p=${x}&page_size=${z}&type=${se}&token_name=${k}&model_name=${Q}&start_timestamp=${pe}&end_timestamp=${Ce}`;const Ve=await _.get(me),{success:Ye,message:Ze,data:ve}=Ve.data;if(Ye)if(x===0)H(ve);else{let Ke=[...t];Ke.splice(x*z,ve.length,...ve),H(Ke)}else p(Ze);c(!1)},b=t.slice((R-1)*j,R*j),J=x=>{L(x),x===Math.ceil(t.length/j)+1&&Y(x-1,j,D).then(z=>{})},w=async x=>{localStorage.setItem("page-size",x+""),h(x),L(1),Y(0,x).then().catch(z=>{p(z)})},G=async()=>{L(1),await Y(0,j,D)},le=async x=>{await Re(x)?Z("已复制："+x):je.error({title:"无法复制到剪贴板，请手动复制",content:x})};return s.useEffect(()=>{const x=parseInt(localStorage.getItem("page-size"))||ie;h(x),Y(0,x).then().catch(z=>{p(z)})},[]),e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(zs,{children:e.jsx(Ue,{spinning:y,children:e.jsxs("h3",{children:["使用明细（总消耗额度：",e.jsx("span",{onClick:i,style:{cursor:"pointer",color:"gray"},children:a?xe(g.quota):"点击查看"}),"）"]})})}),e.jsx(ue,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(ue.Input,{field:"token_name",label:"令牌名称",style:{width:176},value:k,placeholder:"可选值",name:"token_name",onChange:x=>N(x,"token_name")}),e.jsx(ue.Input,{field:"model_name",label:"模型名称",style:{width:176},value:Q,placeholder:"可选值",name:"model_name",onChange:x=>N(x,"model_name")}),e.jsx(ue.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:X,value:X,type:"dateTime",name:"start_timestamp",onChange:x=>N(x,"start_timestamp")}),e.jsx(ue.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:U,value:U,type:"dateTime",name:"end_timestamp",onChange:x=>N(x,"end_timestamp")}),F&&e.jsxs(e.Fragment,{children:[e.jsx(ue.Input,{field:"channel",label:"渠道 ID",style:{width:176},value:O,placeholder:"可选值",name:"channel",onChange:x=>N(x,"channel")}),e.jsx(ue.Input,{field:"username",label:"用户名称",style:{width:176},value:W,placeholder:"可选值",name:"username",onChange:x=>N(x,"username")})]}),e.jsx(ue.Section,{children:e.jsx(v,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:G,loading:r,children:"查询"})})]})}),e.jsx(Je,{style:{marginTop:5},columns:u,dataSource:b,pagination:{currentPage:R,pageSize:j,total:C,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,onPageSizeChange:x=>{w(x).then()},onPageChange:J}}),e.jsxs(Ae,{defaultValue:"0",style:{width:120},onChange:x=>{A(parseInt(x)),Y(0,j,parseInt(x))},children:[e.jsx(Ae.Option,{value:"0",children:"全部"}),e.jsx(Ae.Option,{value:"1",children:"充值"}),e.jsx(Ae.Option,{value:"2",children:"消费"}),e.jsx(Ae.Option,{value:"3",children:"管理"}),e.jsx(Ae.Option,{value:"4",children:"系统"})]})]})})},Ws=()=>e.jsx(e.Fragment,{children:e.jsx(Gs,{})}),Ks=()=>{const u=localStorage.getItem("chat_link");return e.jsx("iframe",{src:u,style:{width:"100%",height:"85vh",border:"none"}})},Wu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function Hs(u){switch(u){case"IMAGINE":return e.jsx(S,{color:"blue",size:"large",children:"绘图"});case"UPSCALE":return e.jsx(S,{color:"orange",size:"large",children:"放大"});case"VARIATION":return e.jsx(S,{color:"purple",size:"large",children:"变换"});case"HIGH_VARIATION":return e.jsx(S,{color:"purple",size:"large",children:"强变换"});case"LOW_VARIATION":return e.jsx(S,{color:"purple",size:"large",children:"弱变换"});case"PAN":return e.jsx(S,{color:"cyan",size:"large",children:"平移"});case"DESCRIBE":return e.jsx(S,{color:"yellow",size:"large",children:"图生文"});case"BLEND":return e.jsx(S,{color:"lime",size:"large",children:"图混合"});case"SHORTEN":return e.jsx(S,{color:"pink",size:"large",children:"缩词"});case"REROLL":return e.jsx(S,{color:"indigo",size:"large",children:"重绘"});case"INPAINT":return e.jsx(S,{color:"violet",size:"large",children:"局部重绘-提交"});case"ZOOM":return e.jsx(S,{color:"teal",size:"large",children:"变焦"});case"CUSTOM_ZOOM":return e.jsx(S,{color:"teal",size:"large",children:"自定义变焦-提交"});case"MODAL":return e.jsx(S,{color:"green",size:"large",children:"窗口处理"});case"SWAP_FACE":return e.jsx(S,{color:"light-green",size:"large",children:"换脸"});default:return e.jsx(S,{color:"white",size:"large",children:"未知"})}}function qs(u){switch(u){case 1:return e.jsx(S,{color:"green",size:"large",children:"已提交"});case 21:return e.jsx(S,{color:"lime",size:"large",children:"等待中"});case 22:return e.jsx(S,{color:"orange",size:"large",children:"重复提交"});case 0:return e.jsx(S,{color:"yellow",size:"large",children:"未提交"});default:return e.jsx(S,{color:"white",size:"large",children:"未知"})}}function Qs(u){switch(u){case"SUCCESS":return e.jsx(S,{color:"green",size:"large",children:"成功"});case"NOT_START":return e.jsx(S,{color:"grey",size:"large",children:"未启动"});case"SUBMITTED":return e.jsx(S,{color:"yellow",size:"large",children:"队列中"});case"IN_PROGRESS":return e.jsx(S,{color:"blue",size:"large",children:"执行中"});case"FAILURE":return e.jsx(S,{color:"red",size:"large",children:"失败"});case"MODAL":return e.jsx(S,{color:"yellow",size:"large",children:"窗口等待"});default:return e.jsx(S,{color:"white",size:"large",children:"未知"})}}const Js=u=>{const t=new Date(u*1e3),l=t.getFullYear(),a=("0"+(t.getMonth()+1)).slice(-2),o=("0"+t.getDate()).slice(-2),r=("0"+t.getHours()).slice(-2),c=("0"+t.getMinutes()).slice(-2),y=("0"+t.getSeconds()).slice(-2);return`${l}-${a}-${o} ${r}:${c}:${y}`},Vs=()=>{const[u,t]=s.useState(!1),[l,a]=s.useState(""),o=[{title:"提交时间",dataIndex:"submit_time",render:(b,J,w)=>e.jsx("div",{children:Js(b/1e3)})},{title:"渠道",dataIndex:"channel_id",className:be()?"tableShow":"tableHiddle",render:(b,J,w)=>e.jsx("div",{children:e.jsxs(S,{color:Wu[parseInt(b)%Wu.length],size:"large",onClick:()=>{Y(b)},children:[" ",b," "]})})},{title:"类型",dataIndex:"action",render:(b,J,w)=>e.jsx("div",{children:Hs(b)})},{title:"任务ID",dataIndex:"mj_id",render:(b,J,w)=>e.jsx("div",{children:b})},{title:"提交结果",dataIndex:"code",className:be()?"tableShow":"tableHiddle",render:(b,J,w)=>e.jsx("div",{children:qs(b)})},{title:"任务状态",dataIndex:"status",className:be()?"tableShow":"tableHiddle",render:(b,J,w)=>e.jsx("div",{children:Qs(b)})},{title:"进度",dataIndex:"progress",render:(b,J,w)=>e.jsx("div",{children:e.jsx(Dt,{stroke:J.status==="FAILURE"?"var(--semi-color-warning)":null,percent:b?parseInt(b.replace("%","")):0,showInfo:!0,"aria-label":"drawing progress"})})},{title:"结果图片",dataIndex:"image_url",render:(b,J,w)=>b?e.jsx(v,{onClick:()=>{W(b),F(!0)},children:"查看图片"}):"无"},{title:"Prompt",dataIndex:"prompt",render:(b,J,w)=>b?e.jsx(V.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{a(b),t(!0)},children:b}):"无"},{title:"PromptEn",dataIndex:"prompt_en",render:(b,J,w)=>b?e.jsx(V.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{a(b),t(!0)},children:b}):"无"},{title:"失败原因",dataIndex:"fail_reason",render:(b,J,w)=>b?e.jsx(V.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{a(b),t(!0)},children:b}):"无"}],[r,c]=s.useState([]),[y,I]=s.useState(!0),[R,L]=s.useState(1),[C,B]=s.useState(ie),[j,h]=s.useState(0),D=be(),[A,F]=s.useState(!1),[P,M]=s.useState(!1),[q,W]=s.useState("");let k=new Date;const[Q,X]=s.useState({channel_id:"",mj_id:"",start_timestamp:we(k.getTime()/1e3-2592e3),end_timestamp:we(k.getTime()/1e3+3600)}),{channel_id:U,mj_id:O,start_timestamp:g,end_timestamp:K}=Q;s.useState({quota:0,token:0});const N=(b,J)=>{X(w=>({...w,[J]:b}))},T=b=>{for(let J=0;J<b.length;J++)b[J].timestamp2string=we(b[J].created_at),b[J].key=""+b[J].id;c(b),B(b.length+ie)},n=async b=>{I(!0);let J="",w=Date.parse(g),G=Date.parse(K);D?J=`/api/mj/?p=${b}&channel_id=${U}&mj_id=${O}&start_timestamp=${w}&end_timestamp=${G}`:J=`/api/mj/self/?p=${b}&mj_id=${O}&start_timestamp=${w}&end_timestamp=${G}`;const le=await _.get(J),{success:x,message:z,data:se}=le.data;if(x)if(b===0)T(se);else{let me=[...r];me.splice(b*ie,se.length,...se),T(me)}else p(z);I(!1)},i=r.slice((R-1)*ie,R*ie),d=b=>{L(b),b===Math.ceil(r.length/ie)+1&&n(b-1).then(J=>{})},H=async()=>{L(1),await n(0)},Y=async b=>{await Re(b)?Z("已复制："+b):je.error({title:"无法复制到剪贴板，请手动复制",content:b})};return s.useEffect(()=>{H().then()},[j]),s.useEffect(()=>{localStorage.getItem("mj_notify_enabled")!=="true"&&M(!0)},[]),e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[D&&P?e.jsx(au,{type:"info",description:"当前未开启Midjourney回调，部分项目可能无法获得绘图结果，可在运营设置中开启。"}):e.jsx(e.Fragment,{}),e.jsx(ue,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(ue.Input,{field:"channel_id",label:"渠道 ID",style:{width:176},value:U,placeholder:"可选值",name:"channel_id",onChange:b=>N(b,"channel_id")}),e.jsx(ue.Input,{field:"mj_id",label:"任务 ID",style:{width:176},value:O,placeholder:"可选值",name:"mj_id",onChange:b=>N(b,"mj_id")}),e.jsx(ue.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:g,value:g,type:"dateTime",name:"start_timestamp",onChange:b=>N(b,"start_timestamp")}),e.jsx(ue.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:K,value:K,type:"dateTime",name:"end_timestamp",onChange:b=>N(b,"end_timestamp")}),e.jsx(ue.Section,{children:e.jsx(v,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:H,children:"查询"})})]})}),e.jsx(Je,{style:{marginTop:5},columns:o,dataSource:i,pagination:{currentPage:R,pageSize:ie,total:C,pageSizeOpts:[10,20,50,100],onPageChange:d},loading:y}),e.jsx(je,{visible:u,onOk:()=>t(!1),onCancel:()=>t(!1),closable:null,bodyStyle:{height:"400px",overflow:"auto"},width:800,children:e.jsx("p",{style:{whiteSpace:"pre-line"},children:l})}),e.jsx(At,{src:q,visible:A,onVisibleChange:b=>F(b)})]})})},Ys=()=>e.jsx(e.Fragment,{children:e.jsx(Vs,{})}),Zs=s.lazy(()=>Tu(()=>import("./index-Cnnre-7C.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Xs=s.lazy(()=>Tu(()=>import("./index-BQlOR68m.js"),__vite__mapDeps([7,1,8,2,3,4,5,6]))),en=s.lazy(()=>Tu(()=>import("./index-c6E1ljfV.js"),__vite__mapDeps([9,1,4,2,3,5,6])));function un(){const[u,t]=s.useContext(We),l=()=>{let a=localStorage.getItem("user");if(a){let o=JSON.parse(a);t({type:"login",payload:o})}};return s.useEffect(()=>{l();let a=Eu();a&&(document.title=a);let o=lu();if(o){let r=document.querySelector("link[rel~='icon']");r&&(r.href=o)}},[]),e.jsx(ae,{children:e.jsx(ae.Content,{children:e.jsxs(mt,{children:[e.jsx(Fe,{path:"/",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(Zs,{})})}),e.jsx(Fe,{path:"/channel",element:e.jsx(Pe,{children:e.jsx(Ss,{})})}),e.jsx(Fe,{path:"/channel/edit/:id",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(Su,{})})}),e.jsx(Fe,{path:"/channel/add",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(Su,{})})}),e.jsx(Fe,{path:"/token",element:e.jsx(Pe,{children:e.jsx(Ts,{})})}),e.jsx(Fe,{path:"/redemption",element:e.jsx(Pe,{children:e.jsx(Ls,{})})}),e.jsx(Fe,{path:"/user",element:e.jsx(Pe,{children:e.jsx(is,{})})}),e.jsx(Fe,{path:"/user/edit/:id",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(wu,{})})}),e.jsx(Fe,{path:"/user/edit",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(wu,{})})}),e.jsx(Fe,{path:"/user/reset",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(Ds,{})})}),e.jsx(Fe,{path:"/login",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(Fs,{})})}),e.jsx(Fe,{path:"/register",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(rs,{})})}),e.jsx(Fe,{path:"/reset",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(ys,{})})}),e.jsx(Fe,{path:"/oauth/github",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(Bs,{})})}),e.jsx(Fe,{path:"/setting",element:e.jsx(Pe,{children:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(fs,{})})})}),e.jsx(Fe,{path:"/topup",element:e.jsx(Pe,{children:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(Os,{})})})}),e.jsx(Fe,{path:"/log",element:e.jsx(Pe,{children:e.jsx(Ws,{})})}),e.jsx(Fe,{path:"/detail",element:e.jsx(Pe,{children:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(Xs,{})})})}),e.jsx(Fe,{path:"/midjourney",element:e.jsx(Pe,{children:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(Ys,{})})})}),e.jsx(Fe,{path:"/about",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(en,{})})}),e.jsx(Fe,{path:"/chat",element:e.jsx(s.Suspense,{fallback:e.jsx(fe,{}),children:e.jsx(Ks,{})})}),e.jsx(Fe,{path:"*",element:e.jsx(ms,{})})]})})})}localStorage.getItem("chat_link");const tn=()=>{const[u,t]=s.useContext(We);let l=Se();const[a,o]=s.useState(!1);Eu(),lu();const r=new Date,c=r.getMonth()===0&&r.getDate()===1||r.getMonth()===1&&r.getDate()>=9&&r.getDate()<=24;async function y(){o(!1),await _.get("/api/user/logout"),Z("注销成功!"),t({type:"logout"}),localStorage.removeItem("user"),l("/login")}const I=()=>{ju.init("root",{}),ju.start(),setTimeout(()=>{ju.stop(),setTimeout(()=>{window.location.reload()},1e4)},3e3)},R=Iu(),L=ps();return s.useEffect(()=>{R==="dark"&&document.body.setAttribute("theme-mode","dark"),c&&console.log("Happy New Year!")},[]),e.jsx(e.Fragment,{children:e.jsx(ae,{children:e.jsx("div",{style:{width:"100%"},children:e.jsx($e,{mode:"horizontal",renderWrapper:({itemElement:C,isSubNav:B,isInSubNav:j,props:h})=>{const D={about:"/about",login:"/login",register:"/register"};return e.jsx(eu,{style:{textDecoration:"none"},to:D[h.itemKey],children:C})},selectedKeys:[],onSelect:C=>{},footer:e.jsxs(e.Fragment,{children:[c&&e.jsx(Oe,{position:"bottomRight",render:e.jsx(Oe.Menu,{children:e.jsx(Oe.Item,{onClick:I,children:"Happy New Year!!!"})}),children:e.jsx($e.Item,{itemKey:"new-year",text:"🏮"})}),e.jsx($e.Item,{itemKey:"about",icon:e.jsx(bt,{})}),e.jsx(Du,{checkedText:"🌞",size:"large",checked:R==="dark",uncheckedText:"🌙",onChange:C=>{L(C)}}),u.user?e.jsx(e.Fragment,{children:e.jsxs(Oe,{position:"bottomRight",render:e.jsx(Oe.Menu,{children:e.jsx(Oe.Item,{onClick:y,children:"退出"})}),children:[e.jsx(ku,{size:"small",color:tu(u.user.username),style:{margin:4},children:u.user.username[0]}),e.jsx("span",{children:u.user.username})]})}):e.jsxs(e.Fragment,{children:[e.jsx($e.Item,{itemKey:"login",text:"登录",icon:e.jsx(Ju,{})}),e.jsx($e.Item,{itemKey:"register",text:"注册",icon:e.jsx(Vu,{})})]})]})})})})})};var sn={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const nn=()=>{Eu();const[u,t]=s.useState(Zt());let l=5;const a=()=>{let o=localStorage.getItem("footer_html");o&&t(o)};return s.useEffect(()=>{const o=setInterval(()=>{if(l<=0){clearInterval(o);return}l--,a()},200);return()=>clearTimeout(o)},[]),e.jsx(ae,{children:e.jsx(ae.Content,{style:{textAlign:"center"},children:u?e.jsx("div",{className:"custom-footer",dangerouslySetInnerHTML:{__html:u}}):e.jsxs("div",{className:"custom-footer",children:[e.jsxs("a",{href:"https://github.com/Calcium-Ion/new-api",target:"_blank",rel:"noreferrer",children:["New API ",sn.VITE_REACT_APP_VERSION," "]}),"由"," ",e.jsx("a",{href:"https://github.com/Calcium-Ion",target:"_blank",rel:"noreferrer",children:"Calcium-Ion"})," ","开发，基于"," ",e.jsx("a",{href:"https://github.com/songquanpeng/one-api",target:"_blank",rel:"noreferrer",children:"One API v0.5.4"})," ","，本项目根据"," ",e.jsx("a",{href:"https://opensource.org/licenses/mit-license.php",children:"MIT 许可证"})," ","授权"]})})})},an=(u,t)=>{switch(t.type){case"set":return{...u,status:t.payload};case"unset":return{...u,status:void 0};default:return u}},it={status:void 0},rt=su.createContext({state:it,dispatch:()=>null}),ln=({children:u})=>{const[t,l]=su.useReducer(an,it);return e.jsx(rt.Provider,{value:[t,l],children:u})},rn=()=>{s.useContext(We);const[u,t]=s.useContext(rt),l=Be()||localStorage.getItem("default_collapse_sidebar")==="true";Se();const[a,o]=s.useState(["home"]),r=Eu(),c=lu(),[y,I]=s.useState(l),R={home:"/",channel:"/channel",token:"/token",redemption:"/redemption",topup:"/topup",user:"/user",log:"/log",midjourney:"/midjourney",setting:"/setting",about:"/about",chat:"/chat",detail:"/detail"},L=s.useMemo(()=>[{text:"首页",itemKey:"home",to:"/",icon:e.jsx(wt,{})},{text:"渠道",itemKey:"channel",to:"/channel",icon:e.jsx(St,{}),className:be()?"semi-navigation-item-normal":"tableHiddle"},{text:"聊天",itemKey:"chat",to:"/chat",icon:e.jsx(vt,{}),className:localStorage.getItem("chat_link")?"semi-navigation-item-normal":"tableHiddle"},{text:"令牌",itemKey:"token",to:"/token",icon:e.jsx(Ju,{})},{text:"兑换码",itemKey:"redemption",to:"/redemption",icon:e.jsx(kt,{}),className:be()?"semi-navigation-item-normal":"tableHiddle"},{text:"钱包",itemKey:"topup",to:"/topup",icon:e.jsx(_t,{})},{text:"用户管理",itemKey:"user",to:"/user",icon:e.jsx(Vu,{}),className:be()?"semi-navigation-item-normal":"tableHiddle"},{text:"日志",itemKey:"log",to:"/log",icon:e.jsx(Tt,{})},{text:"数据看板",itemKey:"detail",to:"/detail",icon:e.jsx(It,{}),className:localStorage.getItem("enable_data_export")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"绘图",itemKey:"midjourney",to:"/midjourney",icon:e.jsx(Pt,{}),className:localStorage.getItem("enable_drawing")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"设置",itemKey:"setting",to:"/setting",icon:e.jsx(Rt,{})}],[localStorage.getItem("enable_data_export"),localStorage.getItem("enable_drawing"),localStorage.getItem("chat_link"),be()]),C=async()=>{const B=await _.get("/api/status");if(B===void 0)return;const{success:j,data:h}=B.data;j?(localStorage.setItem("status",JSON.stringify(h)),t({type:"set",payload:h}),localStorage.setItem("system_name",h.system_name),localStorage.setItem("logo",h.logo),localStorage.setItem("footer_html",h.footer_html),localStorage.setItem("quota_per_unit",h.quota_per_unit),localStorage.setItem("display_in_currency",h.display_in_currency),localStorage.setItem("enable_drawing",h.enable_drawing),localStorage.setItem("enable_data_export",h.enable_data_export),localStorage.setItem("data_export_default_time",h.data_export_default_time),localStorage.setItem("default_collapse_sidebar",h.default_collapse_sidebar),localStorage.setItem("mj_notify_enabled",h.mj_notify_enabled),h.chat_link?localStorage.setItem("chat_link",h.chat_link):localStorage.removeItem("chat_link"),h.chat_link2?localStorage.setItem("chat_link2",h.chat_link2):localStorage.removeItem("chat_link2")):p("无法正常连接至服务器！")};return s.useEffect(()=>{C().then(()=>{I(Be()||localStorage.getItem("default_collapse_sidebar")==="true")});let B=window.location.pathname.split("/")[1];B===""&&(B="home"),o([B])},[]),e.jsx(e.Fragment,{children:e.jsx(ae,{children:e.jsx("div",{style:{height:"100%"},children:e.jsx($e,{style:{maxWidth:200},defaultIsCollapsed:Be()||localStorage.getItem("default_collapse_sidebar")==="true",isCollapsed:y,onCollapseChange:B=>{I(B)},selectedKeys:a,renderWrapper:({itemElement:B,isSubNav:j,isInSubNav:h,props:D})=>e.jsx(eu,{style:{textDecoration:"none"},to:R[D.itemKey],children:B}),items:L,onSelect:B=>{o([B.itemKey])},header:{logo:e.jsx("img",{src:c,alt:"logo",style:{marginRight:"0.75em"}}),text:r},children:e.jsx($e.Footer,{collapseButton:!0})})})})})},on=bu.createRoot(document.getElementById("root")),{Sider:cn,Content:dn,Header:hn}=ae;on.render(e.jsx(su.StrictMode,{children:e.jsx(ln,{children:e.jsx(cs,{children:e.jsx(pt,{children:e.jsx(gs,{children:e.jsxs(ae,{children:[e.jsx(cn,{children:e.jsx(rn,{})}),e.jsxs(ae,{children:[e.jsx(hn,{children:e.jsx(tn,{})}),e.jsx(dn,{style:{padding:"24px"},children:e.jsx(un,{})}),e.jsx(ae.Footer,{children:e.jsx(nn,{})})]}),e.jsx(zt,{})]})})})})})}));export{_ as A,rt as S,p as a,pu as b,En as c,xe as d,jn as g,be as i,e as j,fn as m,Cn as r,Ou as s,we as t};
